\hypertarget{_drum_8h}{
\section{Drum.h File Reference}
\label{_drum_8h}\index{Drum.h@{Drum.h}}
}
{\ttfamily \#include \char`\"{}hal\_\-defs.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}hal\_\-types.h\char`\"{}}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_drum_8h_a3dce674d7d30102891bec80732e47183}{DR0}~0x01
\item 
\#define \hyperlink{_drum_8h_af5e6eea3ca15a02e8126e44956065231}{DR1}~0x02
\item 
\#define \hyperlink{_drum_8h_a7d58fde1b61fc1ee72b2dc9e74631058}{DR2}~0x04
\item 
\#define \hyperlink{_drum_8h_a0e061aa8e105063b876af913ae39543f}{DR3}~0x08
\item 
\#define \hyperlink{_drum_8h_adf3c7eadd772e3752f2aea47320fb60d}{DR4}~0x10
\item 
\#define \hyperlink{_drum_8h_af8e04de9b2b62ba1453131d98cdb712a}{DR5}~0x20
\item 
\#define \hyperlink{_drum_8h_a0aaf4e2767a2e45310477e9f80510d00}{DRUM\_\-PORT}~0
\item 
\#define \hyperlink{_drum_8h_ae8548722567945966cbd90fd4c5ad2a9}{DR0\_\-PIN}~0
\item 
\#define \hyperlink{_drum_8h_a545e0e915c45868e63b7c044c9c3f496}{DR1\_\-PIN}~1
\item 
\#define \hyperlink{_drum_8h_a6009db5793b5ec7634ad11f88e807377}{DR2\_\-PIN}~2
\item 
\#define \hyperlink{_drum_8h_a37c8e666a7f25feb13f547257a9ae9c1}{DR3\_\-PIN}~3
\item 
\#define \hyperlink{_drum_8h_a6b3c210b4a576c07d49d9be2d482afaa}{DR4\_\-PIN}~4
\item 
\#define \hyperlink{_drum_8h_a0dd9f668df9931dc5e5d43a1f9eaf4bf}{DR5\_\-PIN}~5
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{_drum_8h_adfc44485bfaad737798055f9a81622f0}{Intitialize\_\-Drumset} ()
\item 
void \hyperlink{_drum_8h_a4afdbc9f0ae8177e3f3283a1d3a6d605}{DrumSet} ()
\item 
void \hyperlink{_drum_8h_a0affae97623b45f539997ba626ca2036}{playVDrum} ()
\end{DoxyCompactItemize}


\subsection{Define Documentation}
\hypertarget{_drum_8h_a3dce674d7d30102891bec80732e47183}{
\index{Drum.h@{Drum.h}!DR0@{DR0}}
\index{DR0@{DR0}!Drum.h@{Drum.h}}
\subsubsection[{DR0}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR0~0x01}}
\label{_drum_8h_a3dce674d7d30102891bec80732e47183}


Definition at line 19 of file Drum.h.

\hypertarget{_drum_8h_ae8548722567945966cbd90fd4c5ad2a9}{
\index{Drum.h@{Drum.h}!DR0\_\-PIN@{DR0\_\-PIN}}
\index{DR0\_\-PIN@{DR0\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR0\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR0\_\-PIN~0}}
\label{_drum_8h_ae8548722567945966cbd90fd4c5ad2a9}


Definition at line 30 of file Drum.h.

\hypertarget{_drum_8h_af5e6eea3ca15a02e8126e44956065231}{
\index{Drum.h@{Drum.h}!DR1@{DR1}}
\index{DR1@{DR1}!Drum.h@{Drum.h}}
\subsubsection[{DR1}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR1~0x02}}
\label{_drum_8h_af5e6eea3ca15a02e8126e44956065231}


Definition at line 20 of file Drum.h.

\hypertarget{_drum_8h_a545e0e915c45868e63b7c044c9c3f496}{
\index{Drum.h@{Drum.h}!DR1\_\-PIN@{DR1\_\-PIN}}
\index{DR1\_\-PIN@{DR1\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR1\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR1\_\-PIN~1}}
\label{_drum_8h_a545e0e915c45868e63b7c044c9c3f496}


Definition at line 31 of file Drum.h.

\hypertarget{_drum_8h_a7d58fde1b61fc1ee72b2dc9e74631058}{
\index{Drum.h@{Drum.h}!DR2@{DR2}}
\index{DR2@{DR2}!Drum.h@{Drum.h}}
\subsubsection[{DR2}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR2~0x04}}
\label{_drum_8h_a7d58fde1b61fc1ee72b2dc9e74631058}


Definition at line 21 of file Drum.h.

\hypertarget{_drum_8h_a6009db5793b5ec7634ad11f88e807377}{
\index{Drum.h@{Drum.h}!DR2\_\-PIN@{DR2\_\-PIN}}
\index{DR2\_\-PIN@{DR2\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR2\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR2\_\-PIN~2}}
\label{_drum_8h_a6009db5793b5ec7634ad11f88e807377}


Definition at line 32 of file Drum.h.

\hypertarget{_drum_8h_a0e061aa8e105063b876af913ae39543f}{
\index{Drum.h@{Drum.h}!DR3@{DR3}}
\index{DR3@{DR3}!Drum.h@{Drum.h}}
\subsubsection[{DR3}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR3~0x08}}
\label{_drum_8h_a0e061aa8e105063b876af913ae39543f}


Definition at line 22 of file Drum.h.

\hypertarget{_drum_8h_a37c8e666a7f25feb13f547257a9ae9c1}{
\index{Drum.h@{Drum.h}!DR3\_\-PIN@{DR3\_\-PIN}}
\index{DR3\_\-PIN@{DR3\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR3\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR3\_\-PIN~3}}
\label{_drum_8h_a37c8e666a7f25feb13f547257a9ae9c1}


Definition at line 33 of file Drum.h.

\hypertarget{_drum_8h_adf3c7eadd772e3752f2aea47320fb60d}{
\index{Drum.h@{Drum.h}!DR4@{DR4}}
\index{DR4@{DR4}!Drum.h@{Drum.h}}
\subsubsection[{DR4}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR4~0x10}}
\label{_drum_8h_adf3c7eadd772e3752f2aea47320fb60d}


Definition at line 23 of file Drum.h.

\hypertarget{_drum_8h_a6b3c210b4a576c07d49d9be2d482afaa}{
\index{Drum.h@{Drum.h}!DR4\_\-PIN@{DR4\_\-PIN}}
\index{DR4\_\-PIN@{DR4\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR4\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR4\_\-PIN~4}}
\label{_drum_8h_a6b3c210b4a576c07d49d9be2d482afaa}


Definition at line 34 of file Drum.h.

\hypertarget{_drum_8h_af8e04de9b2b62ba1453131d98cdb712a}{
\index{Drum.h@{Drum.h}!DR5@{DR5}}
\index{DR5@{DR5}!Drum.h@{Drum.h}}
\subsubsection[{DR5}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR5~0x20}}
\label{_drum_8h_af8e04de9b2b62ba1453131d98cdb712a}


Definition at line 24 of file Drum.h.

\hypertarget{_drum_8h_a0dd9f668df9931dc5e5d43a1f9eaf4bf}{
\index{Drum.h@{Drum.h}!DR5\_\-PIN@{DR5\_\-PIN}}
\index{DR5\_\-PIN@{DR5\_\-PIN}!Drum.h@{Drum.h}}
\subsubsection[{DR5\_\-PIN}]{\setlength{\rightskip}{0pt plus 5cm}\#define DR5\_\-PIN~5}}
\label{_drum_8h_a0dd9f668df9931dc5e5d43a1f9eaf4bf}


Definition at line 35 of file Drum.h.

\hypertarget{_drum_8h_a0aaf4e2767a2e45310477e9f80510d00}{
\index{Drum.h@{Drum.h}!DRUM\_\-PORT@{DRUM\_\-PORT}}
\index{DRUM\_\-PORT@{DRUM\_\-PORT}!Drum.h@{Drum.h}}
\subsubsection[{DRUM\_\-PORT}]{\setlength{\rightskip}{0pt plus 5cm}\#define DRUM\_\-PORT~0}}
\label{_drum_8h_a0aaf4e2767a2e45310477e9f80510d00}


Definition at line 26 of file Drum.h.



\subsection{Function Documentation}
\hypertarget{_drum_8h_a4afdbc9f0ae8177e3f3283a1d3a6d605}{
\index{Drum.h@{Drum.h}!DrumSet@{DrumSet}}
\index{DrumSet@{DrumSet}!Drum.h@{Drum.h}}
\subsubsection[{DrumSet}]{\setlength{\rightskip}{0pt plus 5cm}void DrumSet (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{_drum_8h_a4afdbc9f0ae8177e3f3283a1d3a6d605}


Definition at line 96 of file Drum.c.


\begin{DoxyCode}
{
  Intitialize_Drumset();
  while(1)
  {
    if(P0 & 0x3F)
    {
      tmp_port = P0;
      for(inn=0;inn<6;inn++)
      {
        if((tmp_port>>inn) & 0x01)
           break;
      }
      if(inn<6 && timerID_DR[inn] == TimerId_INVALID)
      {
         timerID_DR[inn] = SetTimerReq(&Drum_ISR,200);
         halLedToggle(1);
         P0IFG &= ~(1<<inn);
         Capture_DR[inn] = 0;
      }
    }

    if(Print_Flag == 1)
    {
      tx1_send(tx1_buf,3);
      Print_Flag = 0;
    }
  }
}
\end{DoxyCode}
\hypertarget{_drum_8h_adfc44485bfaad737798055f9a81622f0}{
\index{Drum.h@{Drum.h}!Intitialize\_\-Drumset@{Intitialize\_\-Drumset}}
\index{Intitialize\_\-Drumset@{Intitialize\_\-Drumset}!Drum.h@{Drum.h}}
\subsubsection[{Intitialize\_\-Drumset}]{\setlength{\rightskip}{0pt plus 5cm}void Intitialize\_\-Drumset (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{_drum_8h_adfc44485bfaad737798055f9a81622f0}


Definition at line 53 of file Drum.c.


\begin{DoxyCode}
{
  P0SEL = 0;

  MCU_IO_OUTPUT(DRUM_PORT, DR0_PIN, 1);
  MCU_IO_OUTPUT(DRUM_PORT, DR1_PIN, 1);
  MCU_IO_OUTPUT(DRUM_PORT, DR2_PIN, 1);
  MCU_IO_OUTPUT(DRUM_PORT, DR3_PIN, 1);
  MCU_IO_OUTPUT(DRUM_PORT, DR4_PIN, 1);
  MCU_IO_OUTPUT(DRUM_PORT, DR5_PIN, 1);

  MCU_IO_INPUT(DRUM_PORT, DR0_PIN, MCU_IO_PULLUP);
  MCU_IO_INPUT(DRUM_PORT, DR1_PIN, MCU_IO_PULLUP);
  MCU_IO_INPUT(DRUM_PORT, DR2_PIN, MCU_IO_PULLUP);
  MCU_IO_INPUT(DRUM_PORT, DR3_PIN, MCU_IO_PULLUP);
  MCU_IO_INPUT(DRUM_PORT, DR4_PIN, MCU_IO_PULLUP);
  MCU_IO_INPUT(DRUM_PORT, DR5_PIN, MCU_IO_PULLUP);

  MCU_IO_INPUT(DRUM_PORT, 6, MCU_IO_PULLDOWN);
  MCU_IO_INPUT(DRUM_PORT, 7, MCU_IO_PULLDOWN);


  PICTL |= 0x01;   //High to Low Edge
  PICTL |= 0x18;    //Enable Interrupts P0ENH, P0ENL
  P0IF = 0;
  P0IFG = 0;
  P0IE = 1;

  halLedSet(1);
  halLedSet(3);

}
\end{DoxyCode}
\hypertarget{_drum_8h_a0affae97623b45f539997ba626ca2036}{
\index{Drum.h@{Drum.h}!playVDrum@{playVDrum}}
\index{playVDrum@{playVDrum}!Drum.h@{Drum.h}}
\subsubsection[{playVDrum}]{\setlength{\rightskip}{0pt plus 5cm}void playVDrum (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{_drum_8h_a0affae97623b45f539997ba626ca2036}


Definition at line 201 of file Drum.c.


\begin{DoxyCode}
                 {
        
        unsigned char usrExit[] = {0};
        char keyNote = 0;
        unsigned int xCoord = 0;
        unsigned int yCoord = 0;
        unsigned char sendBuf[3] = {0};
        
        while(1) {
                //usrExit = getchar() nblocking in M2
                //In this module do a non blocking recv and chk for STOPMAGIC
                if (RF_gets_nblk(usrExit) != 0) {
                        if (strncmp ((char *)usrExit, "STOP", 4) == 0) {
                                break;
                        }
                }
                else {
                        getTsXY(&xCoord, &yCoord);
                        keyNote = drum_key_match(xCoord, yCoord);
                        halMcuWaitMs(30);
                        if (keyNote) {
                                //send the note over rf and serial
                                sendBuf[0] = 0;                                 /
      /Channel
                                sendBuf[1] = keyNote;           //Note
                                sendBuf[2] = 0x7f;                      //Attack 
      Velocity //TODO: use pressure
                                halMcuWaitMs(50);
                                RF_Send(sendBuf, 3);
                        }
                }
        }//while(1)
}\end{DoxyCode}
