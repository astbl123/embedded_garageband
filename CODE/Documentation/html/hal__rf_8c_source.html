<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Embedded GarageBand: hal_rf.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Picture1.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Embedded GarageBand&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">The project is aimed at developing an embedded Garage band that uses an 8051 microcontroller. The user can access the instruments via the touchscreen+graphics LCD or use the instruments that we have constructed. In this document we will cover the complete detail of the project including its construction, hardware design, software design and debugging.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('hal__rf_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">hal_rf.c</div>  </div>
</div>
<div class="contents">
<a href="hal__rf_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Filename:       hal_rf.c</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  Description:    CC2430 radio interface.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    Code leveraged from Texas Instruments, Inc.</span>
<a name="l00008"></a>00008 <span class="comment">        Modified by:    Niket Shah</span>
<a name="l00009"></a>00009 <span class="comment">                                        Maulik Kapuria</span>
<a name="l00010"></a>00010 <span class="comment">                                        Vishal Verma</span>
<a name="l00011"></a>00011 <span class="comment">******************************************************************************/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="comment">/***********************************************************************************</span>
<a name="l00014"></a>00014 <span class="comment">* INCLUDES</span>
<a name="l00015"></a>00015 <span class="comment">*/</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="hal__board_8h.html">hal_board.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="hal__mcu_8h.html">hal_mcu.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="hal__int_8h.html">hal_int.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="hal__assert_8h.html">hal_assert.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">util.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="hal__rf_8h.html">hal_rf.h</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;string.h&quot;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">/***********************************************************************************</span>
<a name="l00027"></a>00027 <span class="comment">* CONSTANTS AND DEFINES</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// Chip revision</span>
<a name="l00031"></a><a class="code" href="hal__rf_8c.html#a1a3a01252e24d183b59004f6ed934760">00031</a> <span class="preprocessor">#define REV_A                   0x01</span>
<a name="l00032"></a><a class="code" href="hal__rf_8c.html#abd9c42027382cd638c91ba5d236d2848">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define REV_B                   0x02</span>
<a name="l00033"></a><a class="code" href="hal__rf_8c.html#a6eda2b611aa097fa9109e3869966c141">00033</a> <span class="preprocessor"></span><span class="preprocessor">#define REV_C                   0x03</span>
<a name="l00034"></a><a class="code" href="hal__rf_8c.html#a59aac000f03ee539f76459a3b5ec7f56">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define REV_D                   0x04</span>
<a name="l00035"></a><a class="code" href="hal__rf_8c.html#a1fe397279434997dc4952c358abceae3">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define REV_E                   0x05</span>
<a name="l00036"></a><a class="code" href="hal__rf_8c.html#a5b3d1185cfb0933f14b303660bb5babe">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define REV_F                   0x06</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a><a class="code" href="hal__rf_8c.html#a93fb74ef5208df0f0bf8733a58621da6">00038</a> <span class="preprocessor">#define CHIPREVISION            REV_E</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="comment">// Security</span>
<a name="l00041"></a><a class="code" href="hal__rf_8c.html#a6aec5f559f07ba836a5b66da60c202ae">00041</a> <span class="preprocessor">#define PKT_LEN_MAX              127</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="comment">// CC2430 RSSI Offset</span>
<a name="l00044"></a><a class="code" href="hal__rf_8c.html#a2749202671e6c83693acbddba7257782">00044</a> <span class="preprocessor">#define RSSI_OFFSET               45</span>
<a name="l00045"></a><a class="code" href="hal__rf_8c.html#a3608bae06c583b03a48bcefc6963a72b">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define RSSI_OFFSET_LNA_HIGHGAIN  RSSI_OFFSET + 12</span>
<a name="l00046"></a><a class="code" href="hal__rf_8c.html#a946bab7f8b5b685bc6e1aef779de9e4c">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define RSSI_OFFSET_LNA_LOWGAIN   RSSI_OFFSET + 6</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="comment">// RF status flags</span>
<a name="l00049"></a><a class="code" href="hal__rf_8c.html#aabfc3f9a4830311499900d52fa7912c6">00049</a> <span class="preprocessor">#define TX_ACTIVE_FLAG          0x10</span>
<a name="l00050"></a><a class="code" href="hal__rf_8c.html#ab9572988a4c738531edd652e21320612">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define FIFO_FLAG               0x08</span>
<a name="l00051"></a><a class="code" href="hal__rf_8c.html#af2cb4816b7e5c615b2df4e33776163a3">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define FIFOP_FLAG              0x04</span>
<a name="l00052"></a><a class="code" href="hal__rf_8c.html#ad1ab39d16ecca8940c6119ed2a04aa9b">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define SFD_FLAG                0x02</span>
<a name="l00053"></a><a class="code" href="hal__rf_8c.html#ac12d0d5f544ea0b17ad2aef6ddc63ffc">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define CCA_FLAG                0x01</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="comment">// Radio status states</span>
<a name="l00056"></a><a class="code" href="hal__rf_8c.html#a1b0358637b9f0cb65387a43c2845ff72">00056</a> <span class="preprocessor">#define TX_ACTIVE()             (RFSTATUS &amp; TX_ACTIVE_FLAG)</span>
<a name="l00057"></a><a class="code" href="hal__rf_8c.html#a2dbaa6aaf66dbc00fe1e645c6a012de0">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define FIFO()                  (RFSTATUS &amp; FIFO_FLAG)</span>
<a name="l00058"></a><a class="code" href="hal__rf_8c.html#ad806c42b4e21637d1689043e5e107ebc">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define FIFOP()                 (RFSTATUS &amp; FIFOP_FLAG)</span>
<a name="l00059"></a><a class="code" href="hal__rf_8c.html#ad5529c2ca006369ec70573ac840336c3">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define SFD()                   (RFSTATUS &amp; SFD_FLAG)</span>
<a name="l00060"></a><a class="code" href="hal__rf_8c.html#a0661fd27e8d7cadca8d798794cf58c33">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define CCA()                   (RFSTATUS &amp; CCA_FLAG)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="comment">// Various radio settings</span>
<a name="l00063"></a><a class="code" href="hal__rf_8c.html#a63fd4164c3e8e677595dcabb95447398">00063</a> <span class="preprocessor">#define ADR_DECODE              0x08</span>
<a name="l00064"></a><a class="code" href="hal__rf_8c.html#a39c8850603d50d72c5bb979afd9894ee">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define AUTO_CRC                0x20</span>
<a name="l00065"></a><a class="code" href="hal__rf_8c.html#a45f359dd418ecffa942fce7d8827e163">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define AUTO_ACK                0x10</span>
<a name="l00066"></a><a class="code" href="hal__rf_8c.html#aee5c199f27247256f9e949c7e5e8b244">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define AUTO_TX2RX_OFF          0x08</span>
<a name="l00067"></a><a class="code" href="hal__rf_8c.html#af823a5c4028162691e7c706374022d0f">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define RX2RX_TIME_OFF          0x04</span>
<a name="l00068"></a><a class="code" href="hal__rf_8c.html#a1f619e57ce42d8b7209dcea1b3c82fe8">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define ACCEPT_ACKPKT           0x01</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 <span class="comment">// RF interrupt flags</span>
<a name="l00071"></a><a class="code" href="hal__rf_8c.html#a88aba3a287575d734cd91dd841f3e447">00071</a> <span class="preprocessor">#define IRQ_RREG_ON             0x80</span>
<a name="l00072"></a><a class="code" href="hal__rf_8c.html#a73ed0d4ee6167aa506572575dcbe0566">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_TXDONE              0x40</span>
<a name="l00073"></a><a class="code" href="hal__rf_8c.html#a8547f57ea160210b5338685f1638dd54">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_FIFOP               0x20</span>
<a name="l00074"></a><a class="code" href="hal__rf_8c.html#af8117f3fdb8d8290a7a8cb0f97039bf6">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_SFD                 0x10</span>
<a name="l00075"></a><a class="code" href="hal__rf_8c.html#aa5d7deccad9e7eb89a1eb47b76ba2135">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_CCA                 0x08</span>
<a name="l00076"></a><a class="code" href="hal__rf_8c.html#a693df479674df1515c1f6ea455b7d6f6">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_CSP_WT              0x04</span>
<a name="l00077"></a><a class="code" href="hal__rf_8c.html#a6bd07cf6a30fcb5f24800a5855a0be74">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_CSP_STOP            0x02</span>
<a name="l00078"></a><a class="code" href="hal__rf_8c.html#ab73d33d54bce09bc99ebe8c1f4c9fa4e">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define IRQ_CSP_INT             0x01</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a>00080 <span class="comment">// RF status flags</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">// Selected strobes</span>
<a name="l00083"></a><a class="code" href="hal__rf_8c.html#a370c1e8897333ba4833709430cb95202">00083</a> <span class="preprocessor">#define ISRXON()                st(RFST = 0xE2;)</span>
<a name="l00084"></a><a class="code" href="hal__rf_8c.html#a09fe56bfca68be436e0d1ea68edb6b84">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define ISTXON()                st(RFST = 0xE3;)</span>
<a name="l00085"></a><a class="code" href="hal__rf_8c.html#aed0c9a12332abc2b3b13215ad797f3fa">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define ISTXONCCA()             st(RFST = 0xE4;)</span>
<a name="l00086"></a><a class="code" href="hal__rf_8c.html#ab55bf75d022b7f7406fe506944a85acf">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define ISRFOFF()               st(RFST = 0xE5;)</span>
<a name="l00087"></a><a class="code" href="hal__rf_8c.html#a837ff97ede53dfc34b50f0c2ed7a9580">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define ISFLUSHRX()             st(RFST = 0xE6;)</span>
<a name="l00088"></a><a class="code" href="hal__rf_8c.html#aced564cc692dceb8cf8dad8ffa0290e1">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define ISFLUSHTX()             st(RFST = 0xE7;)</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="hal__rf_8c.html#a8a3a2a7f645b81484eae67cf2a8ab2db">00090</a> <span class="preprocessor">#define FLUSH_RX_FIFO()         st( ISFLUSHRX(); ISFLUSHRX(); )</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">// CC2590-CC2591 support</span>
<a name="l00094"></a>00094 <span class="comment">//</span>
<a name="l00095"></a>00095 <span class="preprocessor">#ifdef INCLUDE_PA</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 <span class="comment">/* Select CC2591 RX low gain mode */</span>
<a name="l00098"></a>00098 <span class="preprocessor">#define HAL_PA_LNA_RX_LGM() st( uint8 i; P1_1= 0; for (i=0; i&lt;8; i++) asm(&quot;NOP&quot;); )</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">/* Select CC2591 RX high gain mode */</span>
<a name="l00102"></a>00102 <span class="preprocessor">#define HAL_PA_LNA_RX_HGM() st( uint8 i; P1_1= 1; for (i=0; i&lt;8; i++) asm(&quot;NOP&quot;); )</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00104"></a>00104 <span class="preprocessor">#if INCLUDE_PA==2591</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="comment">/* TX power lookup index */</span>
<a name="l00106"></a>00106 <span class="preprocessor">#define HAL_RF_TXPOWER_0_DBM   0</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_13_DBM  1</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_15_DBM  2</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_18_DBM  3</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_19_DBM  4</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>
<a name="l00112"></a>00112 <span class="comment">/* TX power values */</span>
<a name="l00113"></a>00113 <span class="preprocessor">#define CC2430_TXPOWER_0_DBM   0x06</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_13_DBM  0x13</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_15_DBM  0x17</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_18_DBM  0x5F</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_19_DBM  0xFF</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 <span class="preprocessor">#elif INCLUDE_PA==2590</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="comment">/* TX power lookup index */</span>
<a name="l00121"></a>00121 <span class="preprocessor">#define HAL_RF_TXPOWER_MIN_13_DBM 0</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_MIN_3_DBM  1</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_5_DBM      2</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_10_DBM     3</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_11_DBM     4</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a>00127 <span class="preprocessor">#define CC2430_TXPOWER_MIN_13_DBM 0x63</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_MIN_3_DBM  0x87</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_5_DBM      0x13</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_10_DBM     0x5F</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_11_DBM     0xFF</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a>00134 <span class="preprocessor">#else // dummy macros when not using CC2591</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a><a class="code" href="hal__rf_8c.html#ac6a28604d713f7000bb61aa505499f54">00136</a> <span class="preprocessor">#define HAL_PA_LNA_INIT()</span>
<a name="l00137"></a><a class="code" href="hal__rf_8c.html#a3fb75ebd094558e59cfe878f547b30cf">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define HAL_PA_LNA_RX_LGM()</span>
<a name="l00138"></a><a class="code" href="hal__rf_8c.html#aae5dd1de7d561644c9a031e57f58ca91">00138</a> <span class="preprocessor"></span><span class="preprocessor">#define HAL_PA_LNA_RX_HGM()</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a>00140 <span class="comment">/* TX power lookup index */</span>
<a name="l00141"></a><a class="code" href="hal__rf_8c.html#a6f6be00ae8f0d857a209ae00adf8ada6">00141</a> <span class="preprocessor">#define HAL_RF_TXPOWER_MIN_4_DBM  0</span>
<a name="l00142"></a><a class="code" href="hal__rf_8c.html#ae174a95b283b40eacdce7ada3f088c1b">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define HAL_RF_TXPOWER_0_DBM      1</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00144"></a>00144 <span class="comment">/* TX power values */</span>
<a name="l00145"></a><a class="code" href="hal__rf_8c.html#aa36f4914d0b10d7828487b06fc6a345d">00145</a> <span class="preprocessor">#define CC2430_TXPOWER_0_DBM       0x5F</span>
<a name="l00146"></a><a class="code" href="hal__rf_8c.html#a508d57ca84eaf08ef6a2be3921715690">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define CC2430_TXPOWER_MIN_4_DBM   0x17</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00148"></a>00148 <span class="preprocessor">#endif</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>
<a name="l00150"></a>00150 <span class="comment">/***********************************************************************************</span>
<a name="l00151"></a>00151 <span class="comment">* GLOBAL DATA</span>
<a name="l00152"></a>00152 <span class="comment">*/</span>
<a name="l00153"></a>00153 <span class="preprocessor">#ifdef INCLUDE_PA</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structmenu_item__t.html">menuItem_t</a> <a class="code" href="hal__rf_8c.html#aa2ed81ecf006e05489fb5f88e694987d">pPowerSettings</a>[] =
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156 <span class="preprocessor">#if INCLUDE_PA==2591</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>  <span class="stringliteral">&quot;0dBm&quot;</span>,  <a class="code" href="hal__rf_8c.html#ae174a95b283b40eacdce7ada3f088c1b">HAL_RF_TXPOWER_0_DBM</a>,
<a name="l00158"></a>00158   <span class="stringliteral">&quot;13dBm&quot;</span>, HAL_RF_TXPOWER_13_DBM,
<a name="l00159"></a>00159   <span class="stringliteral">&quot;15dBm&quot;</span>, HAL_RF_TXPOWER_15_DBM,
<a name="l00160"></a>00160   <span class="stringliteral">&quot;18dBm&quot;</span>, HAL_RF_TXPOWER_18_DBM,
<a name="l00161"></a>00161   <span class="stringliteral">&quot;19dBm&quot;</span>, HAL_RF_TXPOWER_19_DBM
<a name="l00162"></a>00162 <span class="preprocessor">#elif INCLUDE_PA==2590</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>  <span class="stringliteral">&quot;-13 dBm&quot;</span>, HAL_RF_TXPOWER_MIN_13_DBM,
<a name="l00164"></a>00164   <span class="stringliteral">&quot;-3 dBm&quot;</span>,  HAL_RF_TXPOWER_MIN_3_DBM,
<a name="l00165"></a>00165   <span class="stringliteral">&quot;5 dBm&quot;</span>,   HAL_RF_TXPOWER_5_DBM,
<a name="l00166"></a>00166   <span class="stringliteral">&quot;10 dBm&quot;</span>,  HAL_RF_TXPOWER_10_DBM,
<a name="l00167"></a>00167   <span class="stringliteral">&quot;11 dBm&quot;</span>,  HAL_RF_TXPOWER_11_DBM
<a name="l00168"></a>00168 <span class="preprocessor">#endif</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>};
<a name="l00170"></a>00170 <span class="preprocessor">#else</span>
<a name="l00171"></a><a class="code" href="hal__rf_8c.html#aa2ed81ecf006e05489fb5f88e694987d">00171</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structmenu_item__t.html">menuItem_t</a> pPowerSettings[] =
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173   <span class="stringliteral">&quot;-4dBm&quot;</span>, <a class="code" href="hal__rf_8c.html#a6f6be00ae8f0d857a209ae00adf8ada6">HAL_RF_TXPOWER_MIN_4_DBM</a>,
<a name="l00174"></a>00174   <span class="stringliteral">&quot;0dBm&quot;</span>, <a class="code" href="hal__rf_8c.html#ae174a95b283b40eacdce7ada3f088c1b">HAL_RF_TXPOWER_0_DBM</a>
<a name="l00175"></a>00175 };
<a name="l00176"></a>00176 <span class="preprocessor">#endif</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a><a class="code" href="hal__rf_8c.html#a67ea5ec1a1ecee5388a849887a4b9e38">00178</a> <span class="keyword">const</span> <a class="code" href="structmenu__t.html">menu_t</a> <a class="code" href="hal__rf_8c.html#a67ea5ec1a1ecee5388a849887a4b9e38">powerMenu</a> =
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <a class="code" href="hal__rf_8c.html#aa2ed81ecf006e05489fb5f88e694987d">pPowerSettings</a>,
<a name="l00181"></a>00181   <a class="code" href="util_8h.html#a80038a9c29f9597f4931f48c92392c30">N_ITEMS</a>(pPowerSettings)
<a name="l00182"></a>00182 };
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">/***********************************************************************************</span>
<a name="l00185"></a>00185 <span class="comment">* LOCAL DATA</span>
<a name="l00186"></a>00186 <span class="comment">*/</span>
<a name="l00187"></a>00187 <span class="preprocessor">#ifndef MRFI</span>
<a name="l00188"></a><a class="code" href="hal__rf_8c.html#ae02b550dfa00d8e5473b1c8d417523f3">00188</a> <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="hal__types_8h.html#ac1e04699e2051474d0bd1c9d3f35b5e3">ISR_FUNC_PTR</a> <a class="code" href="hal__rf_8c.html#ae02b550dfa00d8e5473b1c8d417523f3">pfISR</a>= <a class="code" href="hal__defs_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00189"></a>00189 <span class="preprocessor">#endif</span>
<a name="l00190"></a><a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">00190</a> <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">rssiOffset</a> = <a class="code" href="hal__rf_8c.html#a2749202671e6c83693acbddba7257782">RSSI_OFFSET</a>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">/***********************************************************************************</span>
<a name="l00194"></a>00194 <span class="comment">* LOCAL FUNCTIONS</span>
<a name="l00195"></a>00195 <span class="comment">*/</span>
<a name="l00196"></a>00196 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a8784d785b7fe77d8a834fe718bf12d2d">halPaLnaInit</a>(<span class="keywordtype">void</span>);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="comment">/***********************************************************************************</span>
<a name="l00199"></a>00199 <span class="comment">* GLOBAL FUNCTIONS</span>
<a name="l00200"></a>00200 <span class="comment">*/</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">/***********************************************************************************</span>
<a name="l00203"></a>00203 <span class="comment">* @fn      halRfInit</span>
<a name="l00204"></a>00204 <span class="comment">*</span>
<a name="l00205"></a>00205 <span class="comment">* @brief   Power up, sets default tuning settings, enables autoack, enables random</span>
<a name="l00206"></a>00206 <span class="comment">*          generator.</span>
<a name="l00207"></a>00207 <span class="comment">*</span>
<a name="l00208"></a>00208 <span class="comment">* @param   none</span>
<a name="l00209"></a>00209 <span class="comment">*</span>
<a name="l00210"></a>00210 <span class="comment">* @return  SUCCESS always (for interface compatibility)</span>
<a name="l00211"></a>00211 <span class="comment">*/</span>
<a name="l00212"></a><a class="code" href="hal__rf_8h.html#a3a3c78717a30105882a011973c1ab54b">00212</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a3a3c78717a30105882a011973c1ab54b">halRfInit</a>(<span class="keywordtype">void</span>)
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> i;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="comment">// turning on power to analog part of radio and waiting for voltage regulator.</span>
<a name="l00217"></a>00217     RFPWR = 0x04;
<a name="l00218"></a>00218     <span class="keywordflow">while</span>( RFPWR &amp; 0x10 );
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="comment">// Setting for AUTO CRC and AUTOACK</span>
<a name="l00221"></a>00221     MDMCTRL0L |= (<a class="code" href="hal__rf_8c.html#a39c8850603d50d72c5bb979afd9894ee">AUTO_CRC</a> | <a class="code" href="hal__rf_8c.html#a45f359dd418ecffa942fce7d8827e163">AUTO_ACK</a>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="comment">// Turning on AUTO_TX2RX</span>
<a name="l00224"></a>00224     FSMTC1 = ((FSMTC1 &amp; (~<a class="code" href="hal__rf_8c.html#aee5c199f27247256f9e949c7e5e8b244">AUTO_TX2RX_OFF</a> &amp; ~<a class="code" href="hal__rf_8c.html#af823a5c4028162691e7c706374022d0f">RX2RX_TIME_OFF</a>))  | <a class="code" href="hal__rf_8c.html#a1f619e57ce42d8b7209dcea1b3c82fe8">ACCEPT_ACKPKT</a>);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">// Turning off abortRxOnSrxon.</span>
<a name="l00227"></a>00227     FSMTC1 &amp;= ~0x20;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="comment">// Set FIFOP threshold to maximum</span>
<a name="l00230"></a>00230     IOCFG0 = 0x7F;
<a name="l00231"></a>00231     <span class="comment">// tuning adjustments for optimal radio performance; details available in datasheet */</span>
<a name="l00232"></a>00232     RXCTRL0H = 0x32;
<a name="l00233"></a>00233     RXCTRL0L = 0xF5;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     <span class="comment">// Turning on receiver to get output from IF-ADC</span>
<a name="l00236"></a>00236     <a class="code" href="hal__rf_8c.html#a370c1e8897333ba4833709430cb95202">ISRXON</a>();
<a name="l00237"></a>00237     <a class="code" href="hal__mcu_8c.html#ae4c291df9a657ba3f741e98ce96bd758">halMcuWaitUs</a>(1);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">// Enable random generator</span>
<a name="l00240"></a>00240     ADCCON1 &amp;= ~0x0C;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="keywordflow">for</span>(i = 0 ; i &lt; 32 ; i++)
<a name="l00243"></a>00243     {
<a name="l00244"></a>00244         RNDH = ADCTSTH;
<a name="l00245"></a>00245         <span class="comment">// Clock random generator</span>
<a name="l00246"></a>00246         ADCCON1 |= 0x04;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248     <a class="code" href="hal__rf_8c.html#ab55bf75d022b7f7406fe506944a85acf">ISRFOFF</a>();
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="comment">// Enable CC2591 with High Gain Mode</span>
<a name="l00251"></a>00251     <a class="code" href="hal__rf_8c.html#a8784d785b7fe77d8a834fe718bf12d2d">halPaLnaInit</a>();
<a name="l00252"></a>00252 
<a name="l00253"></a>00253     <a class="code" href="hal__rf_8c.html#a9bcdf2f2fbe6e04668d69adfcc0741ad">halRfEnableRxInterrupt</a>();
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keywordflow">return</span> <a class="code" href="hal__defs_8h.html#aa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">/***********************************************************************************</span>
<a name="l00261"></a>00261 <span class="comment">* @fn      halRfGetChipId</span>
<a name="l00262"></a>00262 <span class="comment">*</span>
<a name="l00263"></a>00263 <span class="comment">* @brief   Get chip id</span>
<a name="l00264"></a>00264 <span class="comment">*</span>
<a name="l00265"></a>00265 <span class="comment">* @param   none</span>
<a name="l00266"></a>00266 <span class="comment">*</span>
<a name="l00267"></a>00267 <span class="comment">* @return  uint8 - result</span>
<a name="l00268"></a>00268 <span class="comment">*/</span>
<a name="l00269"></a><a class="code" href="hal__rf_8h.html#a322c5011f58a161af047d857b6b5967c">00269</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a322c5011f58a161af047d857b6b5967c">halRfGetChipId</a>(<span class="keywordtype">void</span>)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271     <span class="keywordflow">return</span> CHIPID;
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="comment">/***********************************************************************************</span>
<a name="l00276"></a>00276 <span class="comment">* @fn      halRfGetChipVer</span>
<a name="l00277"></a>00277 <span class="comment">*</span>
<a name="l00278"></a>00278 <span class="comment">* @brief   Get chip version</span>
<a name="l00279"></a>00279 <span class="comment">*</span>
<a name="l00280"></a>00280 <span class="comment">* @param   none</span>
<a name="l00281"></a>00281 <span class="comment">*</span>
<a name="l00282"></a>00282 <span class="comment">* @return  uint8 - result</span>
<a name="l00283"></a>00283 <span class="comment">*/</span>
<a name="l00284"></a><a class="code" href="hal__rf_8h.html#a6f48f5e30a113fdcd876fef360f1569e">00284</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a6f48f5e30a113fdcd876fef360f1569e">halRfGetChipVer</a>(<span class="keywordtype">void</span>)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286     <span class="keywordflow">return</span> CHVER;
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="comment">/***********************************************************************************</span>
<a name="l00290"></a>00290 <span class="comment">* @fn      halRfGetStatusByte</span>
<a name="l00291"></a>00291 <span class="comment">*</span>
<a name="l00292"></a>00292 <span class="comment">* @brief   Get chip status byte</span>
<a name="l00293"></a>00293 <span class="comment">*</span>
<a name="l00294"></a>00294 <span class="comment">* @param   none</span>
<a name="l00295"></a>00295 <span class="comment">*</span>
<a name="l00296"></a>00296 <span class="comment">* @return  uint8 - chip status byte</span>
<a name="l00297"></a>00297 <span class="comment">*/</span>
<a name="l00298"></a><a class="code" href="hal__rf_8c.html#a2e3687c0e605e91eb83ff964a598f91e">00298</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a2e3687c0e605e91eb83ff964a598f91e">halRfGetStatusByte</a>(<span class="keywordtype">void</span>)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300     <a class="code" href="hal__assert_8h.html#abf67074868aef51e389b11829a7480ad">HAL_ASSERT</a>(<a class="code" href="key__map_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00301"></a>00301     <span class="keywordflow">return</span> 0;
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/***********************************************************************************</span>
<a name="l00307"></a>00307 <span class="comment">* @fn      halRfGetRandomByte</span>
<a name="l00308"></a>00308 <span class="comment">*</span>
<a name="l00309"></a>00309 <span class="comment">* @brief   Return random byte</span>
<a name="l00310"></a>00310 <span class="comment">*</span>
<a name="l00311"></a>00311 <span class="comment">* @param   none</span>
<a name="l00312"></a>00312 <span class="comment">*</span>
<a name="l00313"></a>00313 <span class="comment">* @return  uint8 - random byte</span>
<a name="l00314"></a>00314 <span class="comment">*/</span>
<a name="l00315"></a><a class="code" href="hal__rf_8h.html#aa606a379904a5cda2bb6731a7d3440d2">00315</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#aa606a379904a5cda2bb6731a7d3440d2">halRfGetRandomByte</a>(<span class="keywordtype">void</span>)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     <span class="comment">// Clock the random generator</span>
<a name="l00318"></a>00318     ADCCON1 |= 0x04;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">return</span> RNDH;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment">/***********************************************************************************</span>
<a name="l00326"></a>00326 <span class="comment">* @fn      halRfGetRssiOffset</span>
<a name="l00327"></a>00327 <span class="comment">*</span>
<a name="l00328"></a>00328 <span class="comment">* @brief   Return RSSI Offset</span>
<a name="l00329"></a>00329 <span class="comment">*</span>
<a name="l00330"></a>00330 <span class="comment">* @param   none</span>
<a name="l00331"></a>00331 <span class="comment">*</span>
<a name="l00332"></a>00332 <span class="comment">* @return  uint8 - RSSI offset</span>
<a name="l00333"></a>00333 <span class="comment">*/</span>
<a name="l00334"></a><a class="code" href="hal__rf_8h.html#a4704f87be83afaa7487891a8527bf2c4">00334</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a4704f87be83afaa7487891a8527bf2c4">halRfGetRssiOffset</a>(<span class="keywordtype">void</span>)
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336   <span class="keywordflow">return</span> <a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">rssiOffset</a>;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="comment">/***********************************************************************************</span>
<a name="l00340"></a>00340 <span class="comment">* @fn      halRfSetChannel</span>
<a name="l00341"></a>00341 <span class="comment">*</span>
<a name="l00342"></a>00342 <span class="comment">* @brief   Set RF channel in the 2.4GHz band. The Channel must be in the range 11-26,</span>
<a name="l00343"></a>00343 <span class="comment">*          11= 2005 MHz, channel spacing 5 MHz.</span>
<a name="l00344"></a>00344 <span class="comment">*</span>
<a name="l00345"></a>00345 <span class="comment">* @param   channel - logical channel number</span>
<a name="l00346"></a>00346 <span class="comment">*</span>
<a name="l00347"></a>00347 <span class="comment">* @return  none</span>
<a name="l00348"></a>00348 <span class="comment">*/</span>
<a name="l00349"></a><a class="code" href="hal__rf_8h.html#ae4b044c4167743fdbcd044ab7cb3688e">00349</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#ae4b044c4167743fdbcd044ab7cb3688e">halRfSetChannel</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> channel)
<a name="l00350"></a>00350 {
<a name="l00351"></a>00351     <a class="code" href="hal__types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> freqMHz;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     freqMHz= 2405 + ((channel - <a class="code" href="hal__rf_8h.html#aa113b8d2f73b3bfbeeda47091a1bf203">MIN_CHANNEL</a>) * <a class="code" href="hal__rf_8h.html#af0cdcc439e5e6efd8219edd0250c08f8">CHANNEL_SPACING</a>); <span class="comment">// Calculate frequency</span>
<a name="l00354"></a>00354     freqMHz -= (<a class="code" href="hal__types_8h.html#a4b435a49c74bb91f284f075e63416cb6">uint32</a>)2048;              <span class="comment">// Subtract; datasheet sect 14.16</span>
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     FSCTRLL = <a class="code" href="hal__defs_8h.html#ab2b94e11f455d94fd743666d4f1364d7">LO_UINT16</a>(freqMHz);
<a name="l00357"></a>00357     FSCTRLH &amp;= ~0x03;
<a name="l00358"></a>00358     FSCTRLH |= (<a class="code" href="hal__defs_8h.html#a869398c9f0eb7bcf1c8e101b052eed07">HI_UINT16</a>(freqMHz) &amp; 0x03);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="comment">/***********************************************************************************</span>
<a name="l00363"></a>00363 <span class="comment">* @fn      halRfSetShortAddr</span>
<a name="l00364"></a>00364 <span class="comment">*</span>
<a name="l00365"></a>00365 <span class="comment">* @brief   Write short address to chip</span>
<a name="l00366"></a>00366 <span class="comment">*</span>
<a name="l00367"></a>00367 <span class="comment">* @param   none</span>
<a name="l00368"></a>00368 <span class="comment">*</span>
<a name="l00369"></a>00369 <span class="comment">* @return  none</span>
<a name="l00370"></a>00370 <span class="comment">*/</span>
<a name="l00371"></a><a class="code" href="hal__rf_8h.html#a60f4374927f82223729323f43c306e39">00371</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a60f4374927f82223729323f43c306e39">halRfSetShortAddr</a>(<a class="code" href="hal__types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> shortAddr)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     SHORTADDRL= <a class="code" href="hal__defs_8h.html#ab2b94e11f455d94fd743666d4f1364d7">LO_UINT16</a>(shortAddr);
<a name="l00374"></a>00374     SHORTADDRH= <a class="code" href="hal__defs_8h.html#a869398c9f0eb7bcf1c8e101b052eed07">HI_UINT16</a>(shortAddr);
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/***********************************************************************************</span>
<a name="l00379"></a>00379 <span class="comment">* @fn      halRfSetPanId</span>
<a name="l00380"></a>00380 <span class="comment">*</span>
<a name="l00381"></a>00381 <span class="comment">* @brief   Write PAN Id to chip</span>
<a name="l00382"></a>00382 <span class="comment">*</span>
<a name="l00383"></a>00383 <span class="comment">* @param   none</span>
<a name="l00384"></a>00384 <span class="comment">*</span>
<a name="l00385"></a>00385 <span class="comment">* @return  none</span>
<a name="l00386"></a>00386 <span class="comment">*/</span>
<a name="l00387"></a><a class="code" href="hal__rf_8h.html#a0e0c4f20453213a674ca6c2c257d9aee">00387</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a7dd55b2adf6e1750715619f51e25f0f9">halRfSetPanId</a>(<a class="code" href="hal__types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> panId)
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389     PANIDL= <a class="code" href="hal__defs_8h.html#ab2b94e11f455d94fd743666d4f1364d7">LO_UINT16</a>(panId);
<a name="l00390"></a>00390     PANIDH= <a class="code" href="hal__defs_8h.html#a869398c9f0eb7bcf1c8e101b052eed07">HI_UINT16</a>(panId);
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 <span class="comment">/***********************************************************************************</span>
<a name="l00395"></a>00395 <span class="comment">* @fn      halRfSetPower</span>
<a name="l00396"></a>00396 <span class="comment">*</span>
<a name="l00397"></a>00397 <span class="comment">* @brief   Set TX output power</span>
<a name="l00398"></a>00398 <span class="comment">*</span>
<a name="l00399"></a>00399 <span class="comment">* @param   uint8 power - power level: TXPOWER_MIN_4_DBM, TXPOWER_0_DBM,</span>
<a name="l00400"></a>00400 <span class="comment">*                        TXPOWER_4_DBM</span>
<a name="l00401"></a>00401 <span class="comment">*</span>
<a name="l00402"></a>00402 <span class="comment">* @return  uint8 - SUCCESS or FAILED</span>
<a name="l00403"></a>00403 <span class="comment">*/</span>
<a name="l00404"></a><a class="code" href="hal__rf_8h.html#af7c9848a53bf4726dd22fe27dd0818c5">00404</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#af7c9848a53bf4726dd22fe27dd0818c5">halRfSetTxPower</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> power)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> v;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">switch</span>(power)
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410 <span class="preprocessor">#if INCLUDE_PA==2591</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="hal__rf_8c.html#ae174a95b283b40eacdce7ada3f088c1b">HAL_RF_TXPOWER_0_DBM</a>:
<a name="l00412"></a>00412         v = <a class="code" href="hal__rf_8c.html#aa36f4914d0b10d7828487b06fc6a345d">CC2430_TXPOWER_0_DBM</a>;
<a name="l00413"></a>00413         <span class="keywordflow">break</span>;
<a name="l00414"></a>00414     <span class="keywordflow">case</span> HAL_RF_TXPOWER_13_DBM:
<a name="l00415"></a>00415         v = CC2430_TXPOWER_13_DBM;
<a name="l00416"></a>00416         <span class="keywordflow">break</span>;
<a name="l00417"></a>00417     <span class="keywordflow">case</span> HAL_RF_TXPOWER_15_DBM:
<a name="l00418"></a>00418         v = CC2430_TXPOWER_15_DBM;
<a name="l00419"></a>00419         <span class="keywordflow">break</span>;
<a name="l00420"></a>00420     <span class="keywordflow">case</span> HAL_RF_TXPOWER_18_DBM:
<a name="l00421"></a>00421         v = CC2430_TXPOWER_18_DBM;
<a name="l00422"></a>00422         <span class="keywordflow">break</span>;
<a name="l00423"></a>00423     <span class="keywordflow">case</span> HAL_RF_TXPOWER_19_DBM:
<a name="l00424"></a>00424         v = CC2430_TXPOWER_18_DBM;
<a name="l00425"></a>00425         <span class="keywordflow">break</span>;
<a name="l00426"></a>00426 <span class="preprocessor">#elif INCLUDE_PA==2590</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span>    <span class="keywordflow">case</span> HAL_RF_TXPOWER_MIN_13_DBM:
<a name="l00428"></a>00428         v = CC2430_TXPOWER_MIN_13_DBM;
<a name="l00429"></a>00429         <span class="keywordflow">break</span>;
<a name="l00430"></a>00430     <span class="keywordflow">case</span> HAL_RF_TXPOWER_MIN_3_DBM:
<a name="l00431"></a>00431         v = CC2430_TXPOWER_MIN_3_DBM;
<a name="l00432"></a>00432         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433     <span class="keywordflow">case</span> HAL_RF_TXPOWER_5_DBM:
<a name="l00434"></a>00434         v = CC2430_TXPOWER_5_DBM;
<a name="l00435"></a>00435         <span class="keywordflow">break</span>;
<a name="l00436"></a>00436     <span class="keywordflow">case</span> HAL_RF_TXPOWER_10_DBM:
<a name="l00437"></a>00437         v = CC2430_TXPOWER_10_DBM;
<a name="l00438"></a>00438         <span class="keywordflow">break</span>;
<a name="l00439"></a>00439     <span class="keywordflow">case</span> HAL_RF_TXPOWER_11_DBM:
<a name="l00440"></a>00440         v = CC2430_TXPOWER_11_DBM;
<a name="l00441"></a>00441         <span class="keywordflow">break</span>;
<a name="l00442"></a>00442 <span class="preprocessor">#else</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="hal__rf_8c.html#ae174a95b283b40eacdce7ada3f088c1b">HAL_RF_TXPOWER_0_DBM</a>:
<a name="l00444"></a>00444         v = <a class="code" href="hal__rf_8c.html#aa36f4914d0b10d7828487b06fc6a345d">CC2430_TXPOWER_0_DBM</a>;
<a name="l00445"></a>00445         <span class="keywordflow">break</span>;
<a name="l00446"></a>00446     <span class="keywordflow">case</span> <a class="code" href="hal__rf_8c.html#a6f6be00ae8f0d857a209ae00adf8ada6">HAL_RF_TXPOWER_MIN_4_DBM</a>:
<a name="l00447"></a>00447         v = <a class="code" href="hal__rf_8c.html#a508d57ca84eaf08ef6a2be3921715690">CC2430_TXPOWER_MIN_4_DBM</a>;
<a name="l00448"></a>00448         <span class="keywordflow">break</span>;
<a name="l00449"></a>00449 <span class="preprocessor">#endif</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>    <span class="keywordflow">default</span>:
<a name="l00451"></a>00451         <span class="keywordflow">return</span> <a class="code" href="hal__defs_8h.html#a681680feae4df4182d532564c42fa1fc">FAILED</a>;
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <span class="comment">// Set TX power</span>
<a name="l00455"></a>00455     TXCTRLL = v;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">return</span> <a class="code" href="hal__defs_8h.html#aa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">/***********************************************************************************</span>
<a name="l00462"></a>00462 <span class="comment">* @fn      halRfSetGain</span>
<a name="l00463"></a>00463 <span class="comment">*</span>
<a name="l00464"></a>00464 <span class="comment">* @brief   Set gain mode - only applicable for units with CC2590/91.</span>
<a name="l00465"></a>00465 <span class="comment">*</span>
<a name="l00466"></a>00466 <span class="comment">* @param   uint8 - gain mode</span>
<a name="l00467"></a>00467 <span class="comment">*</span>
<a name="l00468"></a>00468 <span class="comment">* @return  none</span>
<a name="l00469"></a>00469 <span class="comment">*/</span>
<a name="l00470"></a><a class="code" href="hal__rf_8h.html#a29e872cea848394758b13f24df885d63">00470</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a29e872cea848394758b13f24df885d63">halRfSetGain</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> gainMode)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472     <span class="keywordflow">if</span> (gainMode==<a class="code" href="hal__rf_8h.html#a7b9191ae1eac098fc92b14a3cce09db6">HAL_RF_GAIN_LOW</a>) {
<a name="l00473"></a>00473         <a class="code" href="hal__rf_8c.html#a3fb75ebd094558e59cfe878f547b30cf">HAL_PA_LNA_RX_LGM</a>();
<a name="l00474"></a>00474         <a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">rssiOffset</a> = <a class="code" href="hal__rf_8c.html#a946bab7f8b5b685bc6e1aef779de9e4c">RSSI_OFFSET_LNA_LOWGAIN</a>;
<a name="l00475"></a>00475     } <span class="keywordflow">else</span> {
<a name="l00476"></a>00476         <a class="code" href="hal__rf_8c.html#aae5dd1de7d561644c9a031e57f58ca91">HAL_PA_LNA_RX_HGM</a>();
<a name="l00477"></a>00477         <a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">rssiOffset</a> = <a class="code" href="hal__rf_8c.html#a3608bae06c583b03a48bcefc6963a72b">RSSI_OFFSET_LNA_HIGHGAIN</a>;
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="comment">/***********************************************************************************</span>
<a name="l00482"></a>00482 <span class="comment">* @fn      halRfWriteTxBuf</span>
<a name="l00483"></a>00483 <span class="comment">*</span>
<a name="l00484"></a>00484 <span class="comment">* @brief   Write to TX buffer</span>
<a name="l00485"></a>00485 <span class="comment">*</span>
<a name="l00486"></a>00486 <span class="comment">* @param   uint8* pData - buffer to write</span>
<a name="l00487"></a>00487 <span class="comment">*          uint8 length - number of bytes</span>
<a name="l00488"></a>00488 <span class="comment">*</span>
<a name="l00489"></a>00489 <span class="comment">* @return  none</span>
<a name="l00490"></a>00490 <span class="comment">*/</span>
<a name="l00491"></a><a class="code" href="hal__rf_8h.html#a4371f402044d251326d6288928b0bdd0">00491</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a4371f402044d251326d6288928b0bdd0">halRfWriteTxBuf</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>* pData, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> length)
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> i;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <a class="code" href="hal__rf_8c.html#aced564cc692dceb8cf8dad8ffa0290e1">ISFLUSHTX</a>();          <span class="comment">// Making sure that the TX FIFO is empty.</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     RFIF = ~<a class="code" href="hal__rf_8c.html#a73ed0d4ee6167aa506572575dcbe0566">IRQ_TXDONE</a>;   <span class="comment">// Clear TX done interrupt</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="comment">// Insert data</span>
<a name="l00500"></a>00500     <span class="keywordflow">for</span>(i=0;i&lt;length;i++){
<a name="l00501"></a>00501         RFD = pData[i];
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="comment">/***********************************************************************************</span>
<a name="l00508"></a>00508 <span class="comment">* @fn      halRfAppendTxBuf</span>
<a name="l00509"></a>00509 <span class="comment">*</span>
<a name="l00510"></a>00510 <span class="comment">* @brief   Write to TX buffer</span>
<a name="l00511"></a>00511 <span class="comment">*</span>
<a name="l00512"></a>00512 <span class="comment">* @param   uint8* pData - buffer to write</span>
<a name="l00513"></a>00513 <span class="comment">*          uint8 length - number of bytes</span>
<a name="l00514"></a>00514 <span class="comment">*</span>
<a name="l00515"></a>00515 <span class="comment">* @return  none</span>
<a name="l00516"></a>00516 <span class="comment">*/</span>
<a name="l00517"></a><a class="code" href="hal__rf_8c.html#a5d1594f3f4c1bff47173be284e2255c7">00517</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a5d1594f3f4c1bff47173be284e2255c7">halRfAppendTxBuf</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>* pData, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> length)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> i;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521     <span class="comment">// Insert data</span>
<a name="l00522"></a>00522     <span class="keywordflow">for</span>(i=0;i&lt;length;i++){
<a name="l00523"></a>00523         RFD = pData[i];
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="comment">/***********************************************************************************</span>
<a name="l00529"></a>00529 <span class="comment">* @fn      halRfReadRxBuf</span>
<a name="l00530"></a>00530 <span class="comment">*</span>
<a name="l00531"></a>00531 <span class="comment">* @brief   Read RX buffer</span>
<a name="l00532"></a>00532 <span class="comment">*</span>
<a name="l00533"></a>00533 <span class="comment">* @param   uint8* pData - data buffer. This must be allocated by caller.</span>
<a name="l00534"></a>00534 <span class="comment">*          uint8 length - number of bytes</span>
<a name="l00535"></a>00535 <span class="comment">*</span>
<a name="l00536"></a>00536 <span class="comment">* @return  none</span>
<a name="l00537"></a>00537 <span class="comment">*/</span>
<a name="l00538"></a><a class="code" href="hal__rf_8h.html#a1e4b35a07e3bb5a6875bed1c6878f8e8">00538</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a1e4b35a07e3bb5a6875bed1c6878f8e8">halRfReadRxBuf</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>* pData, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> length)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     <span class="keywordflow">while</span> (length&gt;0) {
<a name="l00541"></a>00541         *pData++= RFD;
<a name="l00542"></a>00542         length--;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">/***********************************************************************************</span>
<a name="l00548"></a>00548 <span class="comment">* @fn      halRfReadMemory</span>
<a name="l00549"></a>00549 <span class="comment">*</span>
<a name="l00550"></a>00550 <span class="comment">* @brief   Read RF device memory</span>
<a name="l00551"></a>00551 <span class="comment">*</span>
<a name="l00552"></a>00552 <span class="comment">* @param   uint16 addr - memory address</span>
<a name="l00553"></a>00553 <span class="comment">*          uint8* pData - data buffer. This must be allocated by caller.</span>
<a name="l00554"></a>00554 <span class="comment">*          uint8 length - number of bytes</span>
<a name="l00555"></a>00555 <span class="comment">*</span>
<a name="l00556"></a>00556 <span class="comment">* @return  Number of bytes read</span>
<a name="l00557"></a>00557 <span class="comment">*/</span>
<a name="l00558"></a><a class="code" href="hal__rf_8h.html#aafef2af65e6e5fb7973fa096baa3a932">00558</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#aafef2af65e6e5fb7973fa096baa3a932">halRfReadMemory</a>(<a class="code" href="hal__types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> addr, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>* pData, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> length)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560     <span class="keywordflow">return</span> 0;
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="comment">/***********************************************************************************</span>
<a name="l00565"></a>00565 <span class="comment">* @fn      halRfWriteMemory</span>
<a name="l00566"></a>00566 <span class="comment">*</span>
<a name="l00567"></a>00567 <span class="comment">* @brief   Write RF device memory</span>
<a name="l00568"></a>00568 <span class="comment">*</span>
<a name="l00569"></a>00569 <span class="comment">* @param   uint16 addr - memory address</span>
<a name="l00570"></a>00570 <span class="comment">*          uint8* pData - data buffer. This must be allocated by caller.</span>
<a name="l00571"></a>00571 <span class="comment">*          uint8 length - number of bytes</span>
<a name="l00572"></a>00572 <span class="comment">*</span>
<a name="l00573"></a>00573 <span class="comment">* @return  Number of bytes written</span>
<a name="l00574"></a>00574 <span class="comment">*/</span>
<a name="l00575"></a><a class="code" href="hal__rf_8h.html#a1254b5ac04c82180f4b93349f9c6e691">00575</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a1254b5ac04c82180f4b93349f9c6e691">halRfWriteMemory</a>(<a class="code" href="hal__types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> addr, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a>* pData, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> length)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <span class="keywordflow">return</span> 0;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="comment">/***********************************************************************************</span>
<a name="l00581"></a>00581 <span class="comment">* @fn      halRfTransmit</span>
<a name="l00582"></a>00582 <span class="comment">*</span>
<a name="l00583"></a>00583 <span class="comment">* @brief   Transmit frame with Clear Channel Assessment.</span>
<a name="l00584"></a>00584 <span class="comment">*</span>
<a name="l00585"></a>00585 <span class="comment">* @param   none</span>
<a name="l00586"></a>00586 <span class="comment">*</span>
<a name="l00587"></a>00587 <span class="comment">* @return  uint8 - SUCCESS or FAILED</span>
<a name="l00588"></a>00588 <span class="comment">*/</span>
<a name="l00589"></a><a class="code" href="hal__rf_8h.html#a58498e7b18acfedc38b011f95f2c1fa1">00589</a> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="hal__rf_8c.html#a58498e7b18acfedc38b011f95f2c1fa1">halRfTransmit</a>(<span class="keywordtype">void</span>)
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> status;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <a class="code" href="hal__rf_8c.html#a09fe56bfca68be436e0d1ea68edb6b84">ISTXON</a>(); <span class="comment">// Sending</span>
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="comment">// Waiting for transmission to finish</span>
<a name="l00596"></a>00596     <span class="keywordflow">while</span>(!(RFIF &amp; <a class="code" href="hal__rf_8c.html#a73ed0d4ee6167aa506572575dcbe0566">IRQ_TXDONE</a>) );
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     RFIF = ~IRQ_TXDONE;
<a name="l00599"></a>00599     status= <a class="code" href="hal__defs_8h.html#aa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">return</span> status;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="comment">/***********************************************************************************</span>
<a name="l00607"></a>00607 <span class="comment">* @fn      halRfReceiveOn</span>
<a name="l00608"></a>00608 <span class="comment">*</span>
<a name="l00609"></a>00609 <span class="comment">* @brief   Turn receiver on</span>
<a name="l00610"></a>00610 <span class="comment">*</span>
<a name="l00611"></a>00611 <span class="comment">* @param   none</span>
<a name="l00612"></a>00612 <span class="comment">*</span>
<a name="l00613"></a>00613 <span class="comment">* @return  none</span>
<a name="l00614"></a>00614 <span class="comment">*/</span>
<a name="l00615"></a><a class="code" href="hal__rf_8h.html#adb9b5c0c3f8c5d464a488929b75284c6">00615</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#adb9b5c0c3f8c5d464a488929b75284c6">halRfReceiveOn</a>(<span class="keywordtype">void</span>)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <a class="code" href="hal__rf_8c.html#a8a3a2a7f645b81484eae67cf2a8ab2db">FLUSH_RX_FIFO</a>();
<a name="l00618"></a>00618     <a class="code" href="hal__rf_8c.html#a370c1e8897333ba4833709430cb95202">ISRXON</a>();
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="comment">/***********************************************************************************</span>
<a name="l00622"></a>00622 <span class="comment">* @fn      halRfReceiveOff</span>
<a name="l00623"></a>00623 <span class="comment">*</span>
<a name="l00624"></a>00624 <span class="comment">* @brief   Turn receiver off</span>
<a name="l00625"></a>00625 <span class="comment">*</span>
<a name="l00626"></a>00626 <span class="comment">* @param   none</span>
<a name="l00627"></a>00627 <span class="comment">*</span>
<a name="l00628"></a>00628 <span class="comment">* @return  none</span>
<a name="l00629"></a>00629 <span class="comment">*/</span>
<a name="l00630"></a><a class="code" href="hal__rf_8h.html#ab2ebc515c36341d1b932d90b716e39d4">00630</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#ab2ebc515c36341d1b932d90b716e39d4">halRfReceiveOff</a>(<span class="keywordtype">void</span>)
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632     <a class="code" href="hal__rf_8c.html#ab55bf75d022b7f7406fe506944a85acf">ISRFOFF</a>();
<a name="l00633"></a>00633     <a class="code" href="hal__rf_8c.html#a8a3a2a7f645b81484eae67cf2a8ab2db">FLUSH_RX_FIFO</a>();
<a name="l00634"></a>00634 }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 <span class="comment">/***********************************************************************************</span>
<a name="l00638"></a>00638 <span class="comment">* @fn      halRfDisableRxInterrupt</span>
<a name="l00639"></a>00639 <span class="comment">*</span>
<a name="l00640"></a>00640 <span class="comment">* @brief   Clear and disable RX interrupt.</span>
<a name="l00641"></a>00641 <span class="comment">*</span>
<a name="l00642"></a>00642 <span class="comment">* @param   none</span>
<a name="l00643"></a>00643 <span class="comment">*</span>
<a name="l00644"></a>00644 <span class="comment">* @return  none</span>
<a name="l00645"></a>00645 <span class="comment">*/</span>
<a name="l00646"></a><a class="code" href="hal__rf_8h.html#a0e9016638b26539914831b98db749967">00646</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a0e9016638b26539914831b98db749967">halRfDisableRxInterrupt</a>(<span class="keywordtype">void</span>)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648   <span class="comment">// disable RX_FIFOP interrupt</span>
<a name="l00649"></a>00649   RFIM &amp;= ~<a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(5);
<a name="l00650"></a>00650   <span class="comment">// disable general RF interrupts</span>
<a name="l00651"></a>00651   IEN2 &amp;= ~<a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(0);
<a name="l00652"></a>00652 }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="comment">/***********************************************************************************</span>
<a name="l00656"></a>00656 <span class="comment">* @fn      halRfEnableRxInterrupt</span>
<a name="l00657"></a>00657 <span class="comment">*</span>
<a name="l00658"></a>00658 <span class="comment">* @brief   Enable RX interrupt.</span>
<a name="l00659"></a>00659 <span class="comment">*</span>
<a name="l00660"></a>00660 <span class="comment">* @param   none</span>
<a name="l00661"></a>00661 <span class="comment">*</span>
<a name="l00662"></a>00662 <span class="comment">* @return  none</span>
<a name="l00663"></a>00663 <span class="comment">*/</span>
<a name="l00664"></a><a class="code" href="hal__rf_8h.html#a9bcdf2f2fbe6e04668d69adfcc0741ad">00664</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a9bcdf2f2fbe6e04668d69adfcc0741ad">halRfEnableRxInterrupt</a>(<span class="keywordtype">void</span>)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666   <span class="comment">// enable RX_FIFOP interrupt</span>
<a name="l00667"></a>00667   RFIM |= <a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(5);
<a name="l00668"></a>00668   <span class="comment">// enable general RF interrupts</span>
<a name="l00669"></a>00669   IEN2 |= <a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(0);
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 <span class="preprocessor">#ifndef MRFI</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span><span class="comment">/***********************************************************************************</span>
<a name="l00674"></a>00674 <span class="comment">* @fn      halRfRxInterruptConfig</span>
<a name="l00675"></a>00675 <span class="comment">*</span>
<a name="l00676"></a>00676 <span class="comment">* @brief   Configure RX interrupt.</span>
<a name="l00677"></a>00677 <span class="comment">*</span>
<a name="l00678"></a>00678 <span class="comment">* @param   none</span>
<a name="l00679"></a>00679 <span class="comment">*</span>
<a name="l00680"></a>00680 <span class="comment">* @return  none</span>
<a name="l00681"></a>00681 <span class="comment">*/</span>
<a name="l00682"></a><a class="code" href="hal__rf_8h.html#a19617166d101f77cbb38cc0f0860b733">00682</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#afad1482a48a69980ae862f9d987c96fa">halRfRxInterruptConfig</a>(<a class="code" href="hal__types_8h.html#ac1e04699e2051474d0bd1c9d3f35b5e3">ISR_FUNC_PTR</a> pf)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="_touch_screen_8h.html#a676e0da0ef83bbbdf42538e54b97506b">x</a>;
<a name="l00685"></a>00685     HAL_INT_LOCK(x);
<a name="l00686"></a>00686     <a class="code" href="hal__rf_8c.html#ae02b550dfa00d8e5473b1c8d417523f3">pfISR</a>= pf;
<a name="l00687"></a>00687     HAL_INT_UNLOCK(x);
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 <span class="preprocessor">#endif</span>
<a name="l00690"></a>00690 <span class="preprocessor"></span>
<a name="l00691"></a>00691 <span class="comment">/***********************************************************************************</span>
<a name="l00692"></a>00692 <span class="comment">* @fn      halRfWaitTransceiverReady</span>
<a name="l00693"></a>00693 <span class="comment">*</span>
<a name="l00694"></a>00694 <span class="comment">* @brief   Wait until the transciever is ready (SFD inactive).</span>
<a name="l00695"></a>00695 <span class="comment">*</span>
<a name="l00696"></a>00696 <span class="comment">* @param   none</span>
<a name="l00697"></a>00697 <span class="comment">*</span>
<a name="l00698"></a>00698 <span class="comment">* @return  none</span>
<a name="l00699"></a>00699 <span class="comment">*/</span>
<a name="l00700"></a><a class="code" href="hal__rf_8h.html#ae8a0ea8b57301765996561e4b703f6e7">00700</a> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#ae8a0ea8b57301765996561e4b703f6e7">halRfWaitTransceiverReady</a>(<span class="keywordtype">void</span>)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702     <span class="keywordflow">while</span> (RFSTATUS &amp; (<a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(1) | <a class="code" href="hal__defs_8h.html#a23c9c8c18abfb7d5f0807cd4ebdbb468">BV</a>(4) ));
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705 <span class="preprocessor">#ifndef MRFI</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span><span class="comment">/************************************************************************************</span>
<a name="l00707"></a>00707 <span class="comment"> * @fn          macMcuRfIsr</span>
<a name="l00708"></a>00708 <span class="comment"> *</span>
<a name="l00709"></a>00709 <span class="comment"> * @brief       Interrupt service routine that handles FIFOP interrupts.</span>
<a name="l00710"></a>00710 <span class="comment"> *</span>
<a name="l00711"></a>00711 <span class="comment"> * @param       none</span>
<a name="l00712"></a>00712 <span class="comment"> *</span>
<a name="l00713"></a>00713 <span class="comment"> * @return      none</span>
<a name="l00714"></a>00714 <span class="comment"> */</span>
<a name="l00715"></a><a class="code" href="hal__rf_8c.html#a78396106c4eaa379f0e0da1e7a3b5ee3">00715</a> <a class="code" href="_drum_8c.html#aca02366611435e1d7a323cbe6a35c76c">HAL_ISR_FUNCTION</a>( macMcuRfIsr, RF_VECTOR )
<a name="l00716"></a>00716 {
<a name="l00717"></a>00717     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> rfim;
<a name="l00718"></a>00718     <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="_touch_screen_8h.html#a676e0da0ef83bbbdf42538e54b97506b">x</a>;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     HAL_INT_LOCK(x);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     rfim = RFIM;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="keywordflow">if</span> ((RFIF &amp; <a class="code" href="hal__rf_8c.html#a8547f57ea160210b5338685f1638dd54">IRQ_FIFOP</a>) &amp; rfim)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726         (<a class="code" href="hal__rf_8c.html#ae02b550dfa00d8e5473b1c8d417523f3">pfISR</a>)();                  <span class="comment">// Execute the custom ISR</span>
<a name="l00727"></a>00727         S1CON= 0;
<a name="l00728"></a>00728         RFIF&amp;= ~IRQ_FIFOP;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     HAL_INT_UNLOCK(x);
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 <span class="preprocessor">#endif</span>
<a name="l00733"></a>00733 <span class="preprocessor"></span>
<a name="l00734"></a>00734 <span class="comment">/***********************************************************************************</span>
<a name="l00735"></a>00735 <span class="comment">* LOCAL FUNCTIONS</span>
<a name="l00736"></a>00736 <span class="comment">*/</span>
<a name="l00737"></a><a class="code" href="hal__rf_8c.html#a8784d785b7fe77d8a834fe718bf12d2d">00737</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hal__rf_8c.html#a8784d785b7fe77d8a834fe718bf12d2d">halPaLnaInit</a>(<span class="keywordtype">void</span>)
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739 <span class="preprocessor">#ifdef INCLUDE_PA</span>
<a name="l00740"></a>00740 <span class="preprocessor"></span>    <span class="comment">/* Initialize CC2591 to RX high gain mode */</span>
<a name="l00741"></a>00741     <span class="keyword">static</span> <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> fFirst= <a class="code" href="key__map_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="keywordflow">if</span>(fFirst) {
<a name="l00744"></a>00744         <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> i;
<a name="l00745"></a>00745         P1SEL&amp;= ~0x02;
<a name="l00746"></a>00746         P1DIR|= 0x02;
<a name="l00747"></a>00747         P1_1= 1;
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">for</span> (i=0; i&lt;8; i++) {
<a name="l00750"></a>00750             <span class="keyword">asm</span>(<span class="stringliteral">&quot;NOP&quot;</span>);
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752         fFirst = <a class="code" href="key__map_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00753"></a>00753         <a class="code" href="hal__rf_8c.html#aca7e4231c9609a6c462cf44bcb359433">rssiOffset</a> = <a class="code" href="hal__rf_8c.html#a3608bae06c583b03a48bcefc6963a72b">RSSI_OFFSET_LNA_HIGHGAIN</a>;
<a name="l00754"></a>00754         
<a name="l00755"></a>00755 <span class="preprocessor">#ifdef CC2430_CC2591EM_2_0         </span>
<a name="l00756"></a>00756 <span class="preprocessor"></span>        <span class="comment">// Configure IOCFG1 register</span>
<a name="l00757"></a>00757         <span class="comment">// ffctrl_fs_pd on P1.7</span>
<a name="l00758"></a>00758         IOCFG1 = 0x66;
<a name="l00759"></a>00759 <span class="preprocessor">#endif</span>
<a name="l00760"></a>00760 <span class="preprocessor"></span>    }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 <span class="preprocessor">#else // do nothing</span>
<a name="l00763"></a>00763 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>}
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="hal__rf_8c.html">hal_rf.c</a>      </li>
      <li class="footer">Generated on Sat Apr 30 2011 08:30:24 for Embedded GarageBand by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
