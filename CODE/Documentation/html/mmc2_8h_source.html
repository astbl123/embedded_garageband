<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Embedded GarageBand: mmc2.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Picture1.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Embedded GarageBand&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">The project is aimed at developing an embedded Garage band that uses an 8051 microcontroller. The user can access the instruments via the touchscreen+graphics LCD or use the instruments that we have constructed. In this document we will cover the complete detail of the project including its construction, hardware design, software design and debugging.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('mmc2_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">mmc2.h</div>  </div>
</div>
<div class="contents">
<a href="mmc2_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">  Filename:     mmc2.c</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">  Description:  FUNCTIONS FOR SD RAW DATA TRANSFER</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Code leveraged from www.dharmanitech.com</span>
<a name="l00007"></a>00007 <span class="comment">        Modified by:    Niket Shah</span>
<a name="l00008"></a>00008 <span class="comment">                                        Maulik Kapuria</span>
<a name="l00009"></a>00009 <span class="comment">                                        Vishal Verma</span>
<a name="l00010"></a>00010 <span class="comment">***********************************************************************************/</span>
<a name="l00011"></a>00011 <span class="comment">//**************************************************************</span>
<a name="l00012"></a>00012 <span class="comment">// ****** FUNCTIONS FOR SD RAW DATA TRANSFER *******</span>
<a name="l00013"></a>00013 <span class="comment">//**************************************************************</span>
<a name="l00014"></a>00014 <span class="comment">//Controller: ATmega32 (Clock: 8 Mhz-internal)</span>
<a name="l00015"></a>00015 <span class="comment">//Compiler      : AVR-GCC (winAVR with AVRStudio)</span>
<a name="l00016"></a>00016 <span class="comment">//Version       : 2.3</span>
<a name="l00017"></a>00017 <span class="comment">//Author        : CC Dharmani, Chennai (India)</span>
<a name="l00018"></a>00018 <span class="comment">//                        www.dharmanitech.com</span>
<a name="l00019"></a>00019 <span class="comment">//Date          : 08 May 2010</span>
<a name="l00020"></a>00020 <span class="comment">//**************************************************************</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">//**************************************************</span>
<a name="l00023"></a>00023 <span class="comment">// ***** HEADER FILE : SD_routines.h ******</span>
<a name="l00024"></a>00024 <span class="comment">//**************************************************</span>
<a name="l00025"></a>00025 <span class="preprocessor">#ifndef _SD_ROUTINES_H_</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#define _SD_ROUTINES_H_</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="comment">//Use following macro if you don&#39;t want to activate the multiple block access functions</span>
<a name="l00029"></a>00029 <span class="comment">//those functions are not required for FAT32</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="mmc2_8h.html#a4c9caedf210e9e4e61475e4e86293123">00031</a> <span class="preprocessor">#define FAT_TESTING_ONLY         </span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="comment">//use following macros if PB1 pin is used for Chip Select of SD</span>
<a name="l00034"></a><a class="code" href="mmc2_8h.html#ab42aba8ac59f4a88718f351bf6e30874">00034</a> <span class="preprocessor">#define SD_CS_ASSERT     CS_LOW();</span>
<a name="l00035"></a><a class="code" href="mmc2_8h.html#ac13a5b7ed7d2ee96da07f2b2ae9249fe">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_CS_DEASSERT   CS_HIGH();</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="comment">//use following macros if SS (PB4) pin is used for Chip Select of SD</span>
<a name="l00038"></a>00038 <span class="comment">//#define SD_CS_ASSERT     PORTB &amp;= ~0x10</span>
<a name="l00039"></a>00039 <span class="comment">//#define SD_CS_DEASSERT   PORTB |= 0x10</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">//SD commands, many of these are not used here</span>
<a name="l00042"></a><a class="code" href="mmc2_8h.html#a939c1c73db7a96767f5d06dfe7591b01">00042</a> <span class="preprocessor">#define GO_IDLE_STATE            0</span>
<a name="l00043"></a><a class="code" href="mmc2_8h.html#a2397afdad46162ab52c4008d8f5dab23">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define SEND_OP_COND             1</span>
<a name="l00044"></a><a class="code" href="mmc2_8h.html#a01bcf82717d75d8ccf0a8664d431738d">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define SEND_IF_COND                     8</span>
<a name="l00045"></a><a class="code" href="mmc2_8h.html#a85a884eec438d450dc1c05e8d9d29044">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define SEND_CSD                 9</span>
<a name="l00046"></a><a class="code" href="mmc2_8h.html#a0f220568605a0eaa9a5cbb3d3cc82408">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define STOP_TRANSMISSION        12</span>
<a name="l00047"></a><a class="code" href="mmc2_8h.html#a7f98c79059221d788e2219865d770648">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define SEND_STATUS              13</span>
<a name="l00048"></a><a class="code" href="mmc2_8h.html#a2f0756e65bb52b5d7e7934ce1d5ec0da">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_BLOCK_LEN            16</span>
<a name="l00049"></a><a class="code" href="mmc2_8h.html#a078b4c06f187324dd4e14cf59a6c87c2">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_SINGLE_BLOCK        17</span>
<a name="l00050"></a><a class="code" href="mmc2_8h.html#ac1b68c53e7902f7197cd9f52b163bda1">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_MULTIPLE_BLOCKS     18</span>
<a name="l00051"></a><a class="code" href="mmc2_8h.html#ae24d09e65670aa853aa83889b55a92a0">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_SINGLE_BLOCK       24</span>
<a name="l00052"></a><a class="code" href="mmc2_8h.html#a8cf5245e676d5405878f2af647491553">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define WRITE_MULTIPLE_BLOCKS    25</span>
<a name="l00053"></a><a class="code" href="mmc2_8h.html#a0fe84e05b768d0f4b0f98a7f48a19f7f">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define ERASE_BLOCK_START_ADDR   32</span>
<a name="l00054"></a><a class="code" href="mmc2_8h.html#ade170f78d275c9bfd354e726e12435e2">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define ERASE_BLOCK_END_ADDR     33</span>
<a name="l00055"></a><a class="code" href="mmc2_8h.html#ae9177be3107326be877417b3b02e3a83">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define ERASE_SELECTED_BLOCKS    38</span>
<a name="l00056"></a><a class="code" href="mmc2_8h.html#a38e73c548131f1fd3f8acdad82fd44fb">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_SEND_OP_COND                  41   //ACMD</span>
<a name="l00057"></a><a class="code" href="mmc2_8h.html#acdb057504ceebb40cb4a5df3197a8fb5">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define APP_CMD                                  55</span>
<a name="l00058"></a><a class="code" href="mmc2_8h.html#a9903337fbf33e03e1a9182fbca009313">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define READ_OCR                                 58</span>
<a name="l00059"></a><a class="code" href="mmc2_8h.html#a5104895f45f0891d5bedef91b7dd4a92">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define CRC_ON_OFF               59</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="mmc2_8h.html#ad76d1750a6cdeebd506bfcd6752554d2">00062</a> <span class="preprocessor">#define ON     1</span>
<a name="l00063"></a><a class="code" href="mmc2_8h.html#a29e413f6725b2ba32d165ffaa35b01e5">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define OFF    0</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="mmc2_8h.html#a18e6ba0217759ba11da835a1aa52edbf">00065</a> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>, <a class="code" href="mmc2_8h.html#a18e6ba0217759ba11da835a1aa52edbf">totalBlocks</a>; 
<a name="l00066"></a><a class="code" href="mmc2_8h.html#a7fa85cbe61c04a9f71c57aaf1c04cfcc">00066</a> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8h.html#a7fa85cbe61c04a9f71c57aaf1c04cfcc">SDHC_flag</a>, <a class="code" href="mmc2_8h.html#add9f7153567b2f38191b157d2caf7b79">cardType</a>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="_main__mod3_8c.html#abbb739d03dfe3d5766f427e435af90aa">sd_buffer</a>[512];
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8c.html#a1b26e131140b8ab739faa4dd100d6cf2">SD_init</a>(<span class="keywordtype">void</span>);
<a name="l00071"></a>00071 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8c.html#a9faa6fa4ebcf98a07808f2d2c040dcfd">SD_sendCommand</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg);
<a name="l00072"></a>00072 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8c.html#a479d5a79e118601ffede156b20d87494">SD_readSingleBlock</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>);
<a name="l00073"></a>00073 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8c.html#aa72e78c5d2b4664dfdbb339030a1798c">SD_writeSingleBlock</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>);
<a name="l00074"></a>00074 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8h.html#a53bffe1cf14bfa7bf68d9573e31a2970">SD_readMultipleBlock</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#a18e6ba0217759ba11da835a1aa52edbf">totalBlocks</a>);
<a name="l00075"></a>00075 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8h.html#af2c67f72a35334e82eedebef71964d9a">SD_writeMultipleBlock</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#a18e6ba0217759ba11da835a1aa52edbf">totalBlocks</a>);
<a name="l00076"></a>00076 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mmc2_8c.html#a42f0a626164a7e52e260d0cd735e5479">SD_erase</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#aef9ccbd37ff89101204c1ab239f94453">startBlock</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="mmc2_8h.html#a18e6ba0217759ba11da835a1aa52edbf">totalBlocks</a>);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="mmc2_8h.html">mmc2.h</a>      </li>
      <li class="footer">Generated on Sat Apr 30 2011 08:30:24 for Embedded GarageBand by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
