<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Embedded GarageBand: adc.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Picture1.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Embedded GarageBand&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">The project is aimed at developing an embedded Garage band that uses an 8051 microcontroller. The user can access the instruments via the touchscreen+graphics LCD or use the instruments that we have constructed. In this document we will cover the complete detail of the project including its construction, hardware design, software design and debugging.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('adc_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">adc.h</div>  </div>
</div>
<div class="contents">
<a href="adc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">    Filename: adc.h</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    These functions/macros simplifies usage of the ADC.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Code leveraged from Texas Instruments, Inc.</span>
<a name="l00007"></a>00007 <span class="comment">        Modified by:    Niket Shah</span>
<a name="l00008"></a>00008 <span class="comment">                                        Maulik Kapuria</span>
<a name="l00009"></a>00009 <span class="comment">                                        Vishal Verma</span>
<a name="l00010"></a>00010 <span class="comment">******************************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#ifndef _ADC_H</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#define _ADC_H</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a>00015 <span class="comment">/*******************************************************************************</span>
<a name="l00016"></a>00016 <span class="comment"> * INCLUDES</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;<a class="code" href="hal__types_8h.html">hal_types.h</a>&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="hal__defs_8h.html">hal_defs.h</a>&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/*******************************************************************************</span>
<a name="l00025"></a>00025 <span class="comment"> * CONSTANTS AND MACROS</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">// Macro for setting up a single conversion. If ADCCON1.STSEL = 11, using this</span>
<a name="l00029"></a>00029 <span class="comment">// macro will also start the conversion.</span>
<a name="l00030"></a><a class="code" href="adc_8h.html#aacf2d0e8c7e6c8065cb1b55fa9937078">00030</a> <span class="preprocessor">#define ADC_SINGLE_CONVERSION(settings) st(ADCCON3 = (settings);)</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="comment">// Macro for setting up a single conversion</span>
<a name="l00033"></a><a class="code" href="adc_8h.html#aa59495e5f2aa98ac075929135f417e55">00033</a> <span class="preprocessor">#define ADC_SEQUENCE_SETUP(settings)    st(ADCCON2 = (settings);)</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="comment">// Where _settings_ are the following:</span>
<a name="l00036"></a>00036 <span class="comment">// Reference voltage:</span>
<a name="l00037"></a><a class="code" href="adc_8h.html#ad47fc1875971e9c4a1cad134041befb5">00037</a> <span class="preprocessor">#define ADC_REF_1_25_V      0x00     // Internal 1.25V reference</span>
<a name="l00038"></a><a class="code" href="adc_8h.html#a6bccc318f9426038a87e01c8b7f23b47">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_REF_P0_7        0x40     // External reference on AIN7 pin</span>
<a name="l00039"></a><a class="code" href="adc_8h.html#a3351312ccf970065784014d894725fac">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_REF_AVDD        0x80     // AVDD_SOC pin</span>
<a name="l00040"></a><a class="code" href="adc_8h.html#ab876c99f126c4269ccce36137d93eada">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_REF_P0_6_P0_7   0xC0     // External reference on AIN6-AIN7 differential input</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="comment">// Resolution (decimation rate):</span>
<a name="l00043"></a><a class="code" href="adc_8h.html#a3539e260980a7ba54440bd7ea441be73">00043</a> <span class="preprocessor">#define ADC_7_BIT           0x00     //  64 decimation rate</span>
<a name="l00044"></a><a class="code" href="adc_8h.html#ae1b64ca4573971cabdbabb29a34a332b">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_9_BIT           0x10     // 128 decimation rate</span>
<a name="l00045"></a><a class="code" href="adc_8h.html#ae1014a7810e0b26d3553ef9c570ee0d4">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_10_BIT          0x20     // 256 decimation rate</span>
<a name="l00046"></a><a class="code" href="adc_8h.html#af8e9dc8f68291bfeb3708e1859876d2f">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_12_BIT          0x30     // 512 decimation rate</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="comment">// Input channel:</span>
<a name="l00049"></a><a class="code" href="adc_8h.html#ab501ab79c1a11f4dfd31dc163ac25cf9">00049</a> <span class="preprocessor">#define ADC_AIN0            0x00     // single ended P0_0</span>
<a name="l00050"></a><a class="code" href="adc_8h.html#a4bec1da4968146830aa7af9c9dfe1a27">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN1            0x01     // single ended P0_1</span>
<a name="l00051"></a><a class="code" href="adc_8h.html#a62142d766010781bc20ffc749aff4a85">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN2            0x02     // single ended P0_2</span>
<a name="l00052"></a><a class="code" href="adc_8h.html#ab796548c607d1924eda50303704c1ea6">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN3            0x03     // single ended P0_3</span>
<a name="l00053"></a><a class="code" href="adc_8h.html#acf78b53f118cc96ba9d69833134bbbfa">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN4            0x04     // single ended P0_4</span>
<a name="l00054"></a><a class="code" href="adc_8h.html#a3d2eab5f7c8e7ce95923acc20bb6a909">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN5            0x05     // single ended P0_5</span>
<a name="l00055"></a><a class="code" href="adc_8h.html#ac413603a803c0f23462f710c33e628f4">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN6            0x06     // single ended P0_6</span>
<a name="l00056"></a><a class="code" href="adc_8h.html#a209bcbb26f21787e5daa9a9531ae3b56">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_AIN7            0x07     // single ended P0_7</span>
<a name="l00057"></a><a class="code" href="adc_8h.html#a74b6c3aaa88e8bc5bc9daea83d41b9e5">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_GND             0x0C     // Ground</span>
<a name="l00058"></a><a class="code" href="adc_8h.html#ae05144dc8dd2fae477c09a0e84250597">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_TEMP_SENS       0x0E     // on-chip temperature sensor</span>
<a name="l00059"></a><a class="code" href="adc_8h.html#aeedd2dba288b60ff0d3a75555be7dbae">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_VDD_3           0x0F     // (vdd/3)</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a>00061 <span class="comment">// Macro for starting the ADC in continuous conversion mode</span>
<a name="l00062"></a><a class="code" href="adc_8h.html#ae442ee2b74355d90a59451296709719b">00062</a> <span class="preprocessor">#define ADC_SAMPLE_CONTINUOUS()   \</span>
<a name="l00063"></a>00063 <span class="preprocessor">  do {                            \</span>
<a name="l00064"></a>00064 <span class="preprocessor">    ADCCON1 &amp;= ~0x30;             \</span>
<a name="l00065"></a>00065 <span class="preprocessor">    ADCCON1 |= 0x10;              \</span>
<a name="l00066"></a>00066 <span class="preprocessor">  } while (0)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 <span class="comment">// Macro for stopping the ADC in continuous mode</span>
<a name="l00069"></a><a class="code" href="adc_8h.html#a0c39153533e0104e77d36457ea238f4b">00069</a> <span class="preprocessor">#define ADC_STOP()                \</span>
<a name="l00070"></a>00070 <span class="preprocessor">  do {                            \</span>
<a name="l00071"></a>00071 <span class="preprocessor">    ADCCON1 |= 0x30;              \</span>
<a name="l00072"></a>00072 <span class="preprocessor">  } while (0)</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 <span class="comment">// Macro for initiating a single sample in single-conversion mode (ADCCON1.STSEL = 11).</span>
<a name="l00075"></a><a class="code" href="adc_8h.html#a1ab6247da2a141bb6c53eb693a317aee">00075</a> <span class="preprocessor">#define ADC_SAMPLE_SINGLE()       \</span>
<a name="l00076"></a>00076 <span class="preprocessor">  do{                             \</span>
<a name="l00077"></a>00077 <span class="preprocessor">    ADC_STOP();                   \</span>
<a name="l00078"></a>00078 <span class="preprocessor">    ADCCON1 |= 0x40;              \</span>
<a name="l00079"></a>00079 <span class="preprocessor">} while (0)</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="comment">// Macro for configuring the ADC to be started from T1 channel 0. (T1 ch 0 must be in compare mode!!)</span>
<a name="l00082"></a><a class="code" href="adc_8h.html#a4b98144d63126ad42d969bb7ba64c073">00082</a> <span class="preprocessor">#define ADC_TRIGGER_FROM_TIMER1() \</span>
<a name="l00083"></a>00083 <span class="preprocessor">  do {                            \</span>
<a name="l00084"></a>00084 <span class="preprocessor">    ADC_STOP();                   \</span>
<a name="l00085"></a>00085 <span class="preprocessor">    ADCCON1 &amp;= ~0x10;             \</span>
<a name="l00086"></a>00086 <span class="preprocessor">  } while (0)</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span>
<a name="l00088"></a>00088 <span class="comment">// Expression indicating whether a conversion is finished or not.</span>
<a name="l00089"></a><a class="code" href="adc_8h.html#ade734693ddf21f1234521fdcd089eab6">00089</a> <span class="preprocessor">#define ADC_SAMPLE_READY()      (ADCCON1 &amp; 0x80)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091 <span class="comment">// Macro for setting/clearing a channel as input of the ADC</span>
<a name="l00092"></a><a class="code" href="adc_8h.html#a386d0612c07fa7bc4779b4df4391278c">00092</a> <span class="preprocessor">#define ADC_ENABLE_CHANNEL(ch)   ADCCFG |=  (0x01 &lt;&lt; ch)</span>
<a name="l00093"></a><a class="code" href="adc_8h.html#a2c72919d5f8e533d190b13767de5e5ec">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define ADC_DISABLE_CHANNEL(ch)  ADCCFG &amp;= ~(0x01 &lt;&lt; ch)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">// Macros for configuring the ADC input:</span>
<a name="l00097"></a>00097 <span class="comment">// Example usage:</span>
<a name="l00098"></a>00098 <span class="comment">//   IO_ADC_PORT0_PIN(0, IO_ADC_EN);</span>
<a name="l00099"></a>00099 <span class="comment">//   IO_ADC_PORT0_PIN(4, IO_ADC_DIS);</span>
<a name="l00100"></a>00100 <span class="comment">//   IO_ADC_PORT0_PIN(6, IO_ADC_EN);</span>
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="adc_8h.html#aeb472872cad000e6149942a8778bb76b">00102</a> <span class="preprocessor">#define IO_ADC_PORT0_PIN(pin, adcEn)  \</span>
<a name="l00103"></a>00103 <span class="preprocessor">  st (                                \</span>
<a name="l00104"></a>00104 <span class="preprocessor">    if (adcEn)                        \</span>
<a name="l00105"></a>00105 <span class="preprocessor">      ADCCFG |= BM( pin );            \</span>
<a name="l00106"></a>00106 <span class="preprocessor">    else                              \</span>
<a name="l00107"></a>00107 <span class="preprocessor">      ADCCFG &amp;= ~BM( pin );           \</span>
<a name="l00108"></a>00108 <span class="preprocessor">  )</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00110"></a>00110 <span class="comment">// where adcEn is one of:</span>
<a name="l00111"></a><a class="code" href="adc_8h.html#abdef4983e7b234af907c313736cdb7a7">00111</a> <span class="preprocessor">#define IO_ADC_EN           1 // ADC input enabled</span>
<a name="l00112"></a><a class="code" href="adc_8h.html#a279cfc6828199a00c1d8224fa81b0d3d">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define IO_ADC_DIS          0 // ADC input disab</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">/*******************************************************************************</span>
<a name="l00116"></a>00116 <span class="comment"> * PUBLIC FUNCTIONS</span>
<a name="l00117"></a>00117 <span class="comment"> */</span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <a class="code" href="hal__types_8h.html#a259fa4834387bd68627ddf37bb3ebdb9">int16</a> <a class="code" href="adc_8c.html#a889de971419f723b43f0ebdc6a1062f8">adcSampleSingle</a>(<a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> reference, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> resolution, <a class="code" href="hal__types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> channel);
<a name="l00120"></a>00120 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="adc_8h.html">adc.h</a>      </li>
      <li class="footer">Generated on Sat Apr 30 2011 08:30:24 for Embedded GarageBand by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
