<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Embedded GarageBand: hal_SPI.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Picture1.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Embedded GarageBand&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">The project is aimed at developing an embedded Garage band that uses an 8051 microcontroller. The user can access the instruments via the touchscreen+graphics LCD or use the instruments that we have constructed. In this document we will cover the complete detail of the project including its construction, hardware design, software design and debugging.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('hal___s_p_i_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">hal_SPI.h</div>  </div>
</div>
<div class="contents">
<a href="hal___s_p_i_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">    Filename: hal_spi.h</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    This file defines Low Level I/O routines for the SPI Interface of cc2430.</span>
<a name="l00005"></a>00005 <span class="comment">        </span>
<a name="l00006"></a>00006 <span class="comment">        Developed by:   Niket Shah</span>
<a name="l00007"></a>00007 <span class="comment">                                        Maulik Kapuria</span>
<a name="l00008"></a>00008 <span class="comment">                                        Vishal Verma</span>
<a name="l00009"></a>00009 <span class="comment">******************************************************************************/</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#ifndef _SPILIB_H</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">#define _SPILIB_H</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="hal__board_8h.html">hal_board.h</a>&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00017"></a>00017 <span class="comment">//  These constants are used to identify the chosen SPI and UART</span>
<a name="l00018"></a>00018 <span class="comment">//  interfaces.</span>
<a name="l00019"></a>00019 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00020"></a><a class="code" href="hal___s_p_i_8h.html#afb4d3feb36f22460eb363c193a0b4bfa">00020</a> <span class="preprocessor">#define SER_INTF_NULL    0</span>
<a name="l00021"></a><a class="code" href="hal___s_p_i_8h.html#a9e4c2056002f8da35ec07cbfbc86b530">00021</a> <span class="preprocessor"></span><span class="preprocessor">#define SER_INTF_USART0  1</span>
<a name="l00022"></a><a class="code" href="hal___s_p_i_8h.html#a47482fd0393c59c2ff50610fbe423f36">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define SER_INTF_BITBANG 8</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00026"></a>00026 <span class="comment">// SPI/UART port selections.  Select which port will be used for the interface </span>
<a name="l00027"></a>00027 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00028"></a><a class="code" href="hal___s_p_i_8h.html#ac293fde74fb4d19bbae848d59761ef42">00028</a> <span class="preprocessor">#define SPI_SER_INTF      SER_INTF_USART0  // Interface to MMC</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="comment">//#define SPI_SER_INTF      SER_INTF_BITBANG  // Interface to MMC</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="hal___s_p_i_8h.html#af113ef8698527437ed3ec7f3b1a7ab9f">00034</a> <span class="preprocessor">#define DUMMY_CHAR 0xFF</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#if SPI_SER_INTF == SER_INTF_USART0</span>
<a name="l00039"></a><a class="code" href="hal___s_p_i_8h.html#a52791c6deb9fa76929f89981d8f6ccca">00039</a> <span class="preprocessor"></span><span class="preprocessor"> #define U0CSR_TX_BYTE 0x02</span>
<a name="l00040"></a><a class="code" href="hal___s_p_i_8h.html#a9875af947e4460789cde21b73b3879ac">00040</a> <span class="preprocessor"></span><span class="preprocessor"> #define halSPIRXBUF  U0DBUF</span>
<a name="l00041"></a><a class="code" href="hal___s_p_i_8h.html#add1b58d991bf637cf9bb78eef453eb16">00041</a> <span class="preprocessor"></span><span class="preprocessor"> #define halSPI_SEND(x) U0DBUF=x</span>
<a name="l00042"></a><a class="code" href="hal___s_p_i_8h.html#a71f90ecc1354bb1a6aca09736b270d9c">00042</a> <span class="preprocessor"></span><span class="preprocessor"> #define halSPITXREADY  (U0CSR&amp;0x01)         </span><span class="comment">/* Wait for TX to be ready */</span>
<a name="l00043"></a><a class="code" href="hal___s_p_i_8h.html#a681a8c7108035ed6f613a61d4cbba029">00043</a> <span class="preprocessor"> #define halSPITXDONE  ((U0CSR&amp;0x02)&gt;&gt;1)          </span><span class="comment">/* Wait for TX to finish */</span>
<a name="l00044"></a><a class="code" href="hal___s_p_i_8h.html#a8553a026aeb9c0f444a78ec03c917449">00044</a> <span class="preprocessor"> #define halSPIRXREADY (URX0IF)          </span><span class="comment">/* Wait for TX to be ready */</span>
<a name="l00045"></a>00045  <span class="comment">//#define halSPI_PxIN  SPI_USART0_PxIN</span>
<a name="l00046"></a>00046  <span class="comment">//#define halSPI_SOMI  SPI_USART0_SOMI</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#elif SPI_SER_INTF == SER_INTF_BITBANG</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor"> #define halSPIRXBUF  spi_bitbang_in_data</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor"> #define halSPI_SEND(x) spi_bitbang_inout(x)</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor"> #define halSPITXREADY  0</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor"> #define halSPITXDONE   1</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor"> #define halSPIRXREADY  1</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor"> #define halSPIRXFG_CLR</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor"> #define halSPI_PxIN  SPI_BITBANG_PxIN</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor"> #define halSPI_SOMI  SPI_BITBANG_SOMI</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">// Varialbes</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">// Function Prototypes</span>
<a name="l00064"></a>00064 <span class="keywordtype">void</span> <a class="code" href="hal___s_p_i_8c.html#afbecb4c823529eb4fee58ba57a918d44">halSPISetup</a> (<span class="keywordtype">void</span>);
<a name="l00065"></a>00065 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="hal___s_p_i_8c.html#a5756cd21ae20527cd49ce198a46c87ca">spiSendByte</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data);
<a name="l00066"></a>00066 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="hal___s_p_i_8c.html#ae91f0e3fc95ae042003b55c25ffeadcc">spiReadFrame</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* pBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size);
<a name="l00067"></a>00067 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="hal___s_p_i_8c.html#a1cbc9b6919c21e2a0693da554fa6dd13">spiSendFrame</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* pBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size);
<a name="l00068"></a>00068 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="hal___s_p_i_8c.html#aac2a10918390006f9b3eca36566e9f7d">SPI_transmit</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/******************************************************************************</span>
<a name="l00072"></a>00072 <span class="comment">*******************  USART-UART specific functions/macros   *******************</span>
<a name="l00073"></a>00073 <span class="comment">******************************************************************************/</span>
<a name="l00074"></a>00074 <span class="comment">// The macros in this section simplify UART operation.</span>
<a name="l00075"></a><a class="code" href="hal___s_p_i_8h.html#ac5ec7257df8462332c5e62345ecaf3ff">00075</a> <span class="preprocessor">#define BAUD_E(baud, clkDivPow) (     \</span>
<a name="l00076"></a>00076 <span class="preprocessor">    (baud==2400)   ?  6  +clkDivPow : \</span>
<a name="l00077"></a>00077 <span class="preprocessor">    (baud==4800)   ?  7  +clkDivPow : \</span>
<a name="l00078"></a>00078 <span class="preprocessor">    (baud==9600)   ?  8  +clkDivPow : \</span>
<a name="l00079"></a>00079 <span class="preprocessor">    (baud==14400)  ?  8  +clkDivPow : \</span>
<a name="l00080"></a>00080 <span class="preprocessor">    (baud==19200)  ?  9  +clkDivPow : \</span>
<a name="l00081"></a>00081 <span class="preprocessor">    (baud==28800)  ?  9  +clkDivPow : \</span>
<a name="l00082"></a>00082 <span class="preprocessor">    (baud==38400)  ?  10 +clkDivPow : \</span>
<a name="l00083"></a>00083 <span class="preprocessor">    (baud==57600)  ?  10 +clkDivPow : \</span>
<a name="l00084"></a>00084 <span class="preprocessor">    (baud==76800)  ?  11 +clkDivPow : \</span>
<a name="l00085"></a>00085 <span class="preprocessor">    (baud==115200) ?  11 +clkDivPow : \</span>
<a name="l00086"></a>00086 <span class="preprocessor">    (baud==153600) ?  12 +clkDivPow : \</span>
<a name="l00087"></a>00087 <span class="preprocessor">    (baud==230400) ?  12 +clkDivPow : \</span>
<a name="l00088"></a>00088 <span class="preprocessor">    (baud==307200) ?  13 +clkDivPow : \</span>
<a name="l00089"></a>00089 <span class="preprocessor">    0  )</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="hal___s_p_i_8h.html#aff5aa9e679c52f7a5190e2cc2fc76acd">00092</a> <span class="preprocessor">#define BAUD_M(baud) (      \</span>
<a name="l00093"></a>00093 <span class="preprocessor">    (baud==2400)   ?  59  : \</span>
<a name="l00094"></a>00094 <span class="preprocessor">    (baud==4800)   ?  59  : \</span>
<a name="l00095"></a>00095 <span class="preprocessor">    (baud==9600)   ?  59  : \</span>
<a name="l00096"></a>00096 <span class="preprocessor">    (baud==14400)  ?  216 : \</span>
<a name="l00097"></a>00097 <span class="preprocessor">    (baud==19200)  ?  59  : \</span>
<a name="l00098"></a>00098 <span class="preprocessor">    (baud==28800)  ?  216 : \</span>
<a name="l00099"></a>00099 <span class="preprocessor">    (baud==38400)  ?  59  : \</span>
<a name="l00100"></a>00100 <span class="preprocessor">    (baud==57600)  ?  216 : \</span>
<a name="l00101"></a>00101 <span class="preprocessor">    (baud==76800)  ?  59  : \</span>
<a name="l00102"></a>00102 <span class="preprocessor">    (baud==115200) ?  216 : \</span>
<a name="l00103"></a>00103 <span class="preprocessor">    (baud==153600) ?  59  : \</span>
<a name="l00104"></a>00104 <span class="preprocessor">    (baud==230400) ?  216 : \</span>
<a name="l00105"></a>00105 <span class="preprocessor">    (baud==307200) ?  59  : \</span>
<a name="l00106"></a>00106 <span class="preprocessor">  0)</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">// Options for the SPI_SETUP macro.</span>
<a name="l00110"></a><a class="code" href="hal___s_p_i_8h.html#a943af7f8a98cf5a3f2107ed593215a4b">00110</a> <span class="preprocessor">#define SPI_SLAVE              0x01</span>
<a name="l00111"></a><a class="code" href="hal___s_p_i_8h.html#ae09a2779c2d141aa6a8f8be6d78fe210">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_MASTER             0x00</span>
<a name="l00112"></a><a class="code" href="hal___s_p_i_8h.html#a7f569fe0c016790c3f3c007fcb403be8">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CLOCK_POL_LO       0x00</span>
<a name="l00113"></a><a class="code" href="hal___s_p_i_8h.html#a7223c8423e3d43d649446ddeefe553dd">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CLOCK_POL_HI       0x80</span>
<a name="l00114"></a><a class="code" href="hal___s_p_i_8h.html#aa1c72fdeb9b4261783736b2b4a5fcbc4">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CLOCK_PHA_0        0x00</span>
<a name="l00115"></a><a class="code" href="hal___s_p_i_8h.html#a39fb9305fdd3b74a116ec73d3a025c55">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_CLOCK_PHA_1        0x40</span>
<a name="l00116"></a><a class="code" href="hal___s_p_i_8h.html#aa9dc24175ee4509b9c94ea911741ee27">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_TRANSFER_MSB_FIRST 0x20</span>
<a name="l00117"></a><a class="code" href="hal___s_p_i_8h.html#a2f32cd06f5c589bbb0aa74448196edb4">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define SPI_TRANSFER_MSB_LAST  0x00</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="preprocessor">#endif </span><span class="comment">/* _SPILIB_H */</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="hal___s_p_i_8h.html">hal_SPI.h</a>      </li>
      <li class="footer">Generated on Sat Apr 30 2011 08:30:24 for Embedded GarageBand by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
